<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Weitere Sicherheitsheader (z. B. Content-Security-Policy) sollten über eine Web.config im IIS konfiguriert werden -->
    <title>easyONBOARDING Web</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <style>
        .state-badge {
            padding: 0.25em 0.5em;
            border-radius: 0.25rem;
            font-size: 0.875em;
            font-weight: 500;
            white-space: nowrap;
        }
        .state-new { background-color: #cfe2ff; color: #084298; }
        .state-manager { background-color: #fff3cd; color: #664d03; }
        .state-hr { background-color: #ffd8cc; color: #842029; }
        .state-it { background-color: #d1e7dd; color: #0f5132; }
        .state-completed { background-color: #198754; color: white; }
        .nav-tabs .nav-link.active {
            font-weight: bold;
            border-bottom: 3px solid #0d6efd;
        }
        .logo-container {
            max-height: 50px;
            margin-right: 15px;
        }
        .logo-container img {
            max-height: 40px;
        }
    </style>
    <!-- Additional styles for workflow steps -->
    <style>
        .workflow-container {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        .workflow-step {
            flex: 1;
            text-align: center;
            position: relative;
        }
        .workflow-step:not(:last-child):after {
            content: '';
            position: absolute;
            top: 20px;
            right: 0;
            width: calc(100% - 30px);
            height: 2px;
            background-color: #dee2e6;
            z-index: 0;
        }
        .workflow-step.active .workflow-icon {
            background-color: #0d6efd;
            color: white;
        }
        .workflow-icon {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 50%;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
            color: #555;
        }
        .workflow-step.active {
            color: #0d6efd;
            font-weight: bold;
        }
        .tooltip-container {
            position: relative;
            display: inline-block;
            background-color: #fff;
            border: 1px solid #dee2e6;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
        }
        
        .tooltip-container .tooltip-text {
            visibility: hidden;
            width: 240px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -120px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
    <!-- Add authentication libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <div class="logo-container">
                <img src="logo.png" alt="Logo of easyONBOARDING" />
            </div>
            <a class="navbar-brand" href="#">easyONBOARDING</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="bi bi-house-door"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="navNewEntry"><i class="bi bi-person-plus"></i> Neuer Eintrag</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-archive"></i> Archiv</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-gear"></i> Einstellungen</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle"></i> <span id="currentUser">Username</span>
                            <span class="badge bg-primary" id="userRole">HR</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person"></i> Profil</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-key"></i> Passwort ändern</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" data-action="logout"><i class="bi bi-box-arrow-right"></i> Abmelden</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
            display: inline-block;
            margin-left: 5px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 5px;
            cursor: help;
        }
        
        .tooltip-container .tooltip-text {
            visibility: hidden;
            width: 240px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -120px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
    <!-- Add authentication libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <div class="logo-container">
                <img src="logo.png" alt="easyONBOARDING" />
            </div>
            <a class="navbar-brand" href="#">easyONBOARDING</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="bi bi-house-door"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="navNewEntry"><i class="bi bi-person-plus"></i> Neuer Eintrag</a>
                    </li>olid #dee2e6;
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-archive"></i> Archiv</a>
                    </li>tive .workflow-icon {
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-gear"></i> Einstellungen</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto"> {
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle"></i> <span id="currentUser">Username</span>
                            <span class="badge bg-primary" id="userRole">HR</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person"></i> Profil</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-key"></i> Passwort ändern</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right"></i> Abmelden</a></li>
                        </ul>n;
                    </li>
                </ul>d-color: #555;
            </div> #fff;
        </div>xt-align: center;
    </nav>  border-radius: 6px;
            padding: 5px;
    <div class="container-fluid mt-4">
        <!-- Main interface area -->
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="card mb-3">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-funnel"></i> Filter
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="stateFilter" class="form-label">Status</label>
                            <select class="form-select" id="stateFilter">
                                <option value="">Alle</option>
                                <option value="New">Neu</option>
                                <option value="PendingManagerInput">Warte auf Manager</option>
                                <option value="PendingHRVerification">Warte auf HR Prüfung</option>
                                <option value="ReadyForIT">Bereit für IT</option>
                                <option value="Completed">Abgeschlossen</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="searchText" class="form-label">Suche</label>
                            <input type="text" class="form-control" id="searchText" placeholder="Name oder Beschreibung...">
                        </div>
                        <div class="mb-3">
                            <label for="departmentFilter" class="form-label">Abteilung</label>
                            <select class="form-select" id="departmentFilter">
                                <option value="">Alle</option>
                                <option value="IT">IT</option>
                                <option value="HR">Personalabteilung</option>
                                <option value="Finance">Finanzen</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Sales">Vertrieb</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Zeitraum</label>
                            <div class="input-group mb-2">
                                <span class="input-group-text">Von</span>
                                <input type="date" class="form-control" id="fromDate">
                            </div>
                            <div class="input-group">
                                <span class="input-group-text">Bis</span>
                                <input type="date" class="form-control" id="toDate">
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary w-100" id="applyFilter">
                            <i class="bi bi-search"></i> Filtern
                        </button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <i class="bi bi-tools"></i> Tools
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button type="button" class="btn btn-outline-secondary" id="btnExport">
                                <i class="bi bi-file-earmark-excel"></i> Exportieren
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="btnAuditLog">
                                <i class="bi bi-journal-text"></i> Audit-Log
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="btnRestore">
                                <i class="bi bi-arrow-counterclockwise"></i> Backup wiederherstellen
                            </button>
                        </div>
                    </div>
                </div>
            </div>
                            <label for="stateFilter" class="form-label">Status</label>
            <!-- Main content area -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Onboarding Dashboard</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="btnRefresh">
                                <i class="bi bi-arrow-clockwise"></i> Aktualisieren
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-printer"></i> Drucken
                            </button>
                        </div>
                        <button type="button" class="btn btn-sm btn-primary" id="btnNewRecord">
                            <i class="bi bi-plus-circle"></i> Neuer Eintrag
                        </button>
                    </div>
                </div>
                
                <!-- Tab interface similar to the original application -->
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="hr-tab" data-bs-toggle="tab" data-bs-target="#hr" type="button" role="tab" aria-selected="true">
                            <i class="bi bi-people"></i> HR
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="manager-tab" data-bs-toggle="tab" data-bs-target="#manager" type="button" role="tab" aria-selected="false">
                            <i class="bi bi-person-badge"></i> Abteilungsleiter
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="verification-tab" data-bs-toggle="tab" data-bs-target="#verification" type="button" role="tab" aria-selected="false">
                            <i class="bi bi-check-circle"></i> Prüfung
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="it-tab" data-bs-toggle="tab" data-bs-target="#it" type="button" role="tab" aria-selected="false">
                            <i class="bi bi-pc-display"></i> IT
                        </button>
                    </li>
                </ul>
                <div class="tab-content" id="myTabContent">
                    <!-- HR Tab -->
                    <div class="tab-pane fade show active" id="hr" role="tabpanel" aria-labelledby="hr-tab">
                        <div class="container-fluid py-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <h4>Neuer Mitarbeiter</h4>
                                    <form id="hrForm">s="btn btn-outline-secondary" id="btnAuditLog">
                                        <div class="row mb-3"></i> Audit-Log
                                            <div class="col-md-6">
                                                <label for="txtFirstName" class="form-label">Vorname</label>
                                                <input type="text" class="form-control" id="txtFirstName" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="txtLastName" class="form-label">Nachname</label>
                                                <input type="text" class="form-control" id="txtLastName" required>
                                            </div>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="chkExternal">
                                            <label class="form-check-label" for="chkExternal">Externer Mitarbeiter</label>er-bottom">
                                        </div>Dashboard</h1>
                                        <div class="mb-3" id="extCompanyGroup" style="display: none;">
                                            <label for="txtExtCompany" class="form-label">Externe Firma</label>
                                            <input type="text" class="form-control" id="txtExtCompany">sh">
                                        </div>i-arrow-clockwise"></i> Aktualisieren
                                        <div class="mb-3">
                                            <label for="txtDescription" class="form-label">Beschreibung</label>
                                            <textarea class="form-control" id="txtDescription" rows="2"></textarea>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">n-primary" id="btnNewRecord">
                                                <label for="cmbOffice" class="form-label">Büro</label>
                                                <select class="form-select" id="cmbOffice">
                                                    <option value="">Bitte wählen...</option>
                                                    <option value="A-001">A-001</option>
                                                    <option value="A-002">A-002</option>
                                                    <option value="B-101">B-101</option>
                                                </select>"tablist">
                                            </div>sentation">
                                            <div class="col-md-6">" data-bs-toggle="tab" data-bs-target="#hr" type="button" role="tab" aria-selected="true">
                                                <label for="dtpStartWorkDate" class="form-label">Startdatum</label>
                                                <input type="date" class="form-control" id="dtpStartWorkDate" required>
                                            </div>
                                        </div>"presentation">
                                        <div class="row mb-3">ab" data-bs-toggle="tab" data-bs-target="#manager" type="button" role="tab" aria-selected="false">
                                            <div class="col-md-6">eilungsleiter
                                                <label for="txtPhone" class="form-label">Telefon</label>
                                                <input type="tel" class="form-control" id="txtPhone">
                                            </div>sentation">
                                            <div class="col-md-6">tab" data-bs-toggle="tab" data-bs-target="#verification" type="button" role="tab" aria-selected="false">
                                                <label for="txtMobile" class="form-label">Mobil</label>
                                                <input type="tel" class="form-control" id="txtMobile">
                                            </div>
                                        </div>"presentation">
                                        <div class="mb-3">b" data-bs-toggle="tab" data-bs-target="#it" type="button" role="tab" aria-selected="false">
                                            <label for="txtMail" class="form-label">E-Mail</label>
                                            <input type="email" class="form-control" id="txtMail">
                                        </div>
                                        <div class="mb-3">
                                            <label for="cmbAssignedManager" class="form-label">Verantwortlicher Manager</label>
                                            <select class="form-select" id="cmbAssignedManager" required>
                                                <option value="">Bitte wählen...</option>abelledby="hr-tab">
                                                <option value="Manager1">Michael Müller</option>
                                                <option value="Manager2">Sarah Schmidt</option>
                                                <option value="Manager3">Thomas Weber</option>
                                            </select>iter</h4>
                                        </div>hrForm">
                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-primary" id="btnHRSubmit">
                                                <i class="bi bi-check-lg"></i> Absendenabel">Vorname</label>
                                            </button>t type="text" class="form-control" id="txtFirstName" required>
                                        </div>div>
                                    </form> <div class="col-md-6">
                                </div>          <label for="txtLastName" class="form-label">Nachname</label>
                                <div class="col-md-6"> type="text" class="form-control" id="txtLastName" required>
                                    <h4>Offene Anträge</h4>
                                    <div class="list-group" id="recordList">
                                        <!-- Records will be loaded here -->
                                        <a href="#" class="list-group-item list-group-item-action">External">
                                            <div class="d-flex w-100 justify-content-between">Externer Mitarbeiter</label>
                                                <h5 class="mb-1">Max Mustermann</h5>
                                                <span class="state-badge state-new">Neu</span> none;">
                                            </div> for="txtExtCompany" class="form-label">Externe Firma</label>
                                            <p class="mb-1">Software-Entwickler, IT-Abteilung</p>pany">
                                            <small>Startdatum: 01.04.2023</small>
                                        </a> class="mb-3">
                                        <a href="#" class="list-group-item list-group-item-action">bung</label>
                                            <div class="d-flex w-100 justify-content-between"> rows="2"></textarea>
                                                <h5 class="mb-1">Anna Fischer</h5>
                                                <span class="state-badge state-manager">Warte auf Manager</span>
                                            </div>lass="col-md-6">
                                            <p class="mb-1">Marketing-Manager, Marketing</p>ro</label>
                                            <small>Startdatum: 15.03.2023</small>mbOffice">
                                        </a>        <option value="">Bitte wählen...</option>
                                        <a href="#" class="list-group-item list-group-item-action">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h5 class="mb-1">Jan Schmidt</h5>option>
                                                <span class="state-badge state-hr">Warte auf HR Prüfung</span>
                                            </div>
                                            <p class="mb-1">Finanzanalyst, Finanzen</p>
                                            <small>Startdatum: 01.05.2023</small>ss="form-label">Startdatum</label>
    <div class="modal fade" id="recordModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="recordModalTitle">Mitarbeiter-Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="recordModalBody">
                    <!-- Record details will be loaded here -->
                    <div class="card mb-3">
                            <h4>Offene Anfragen für Manager-Input</h4>s="form-control" id="txtMobile">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> Hier sehen Sie Anträge, die auf Ihre Bearbeitung warten. Bitte fügen Sie die notwendigen Informationen hinzu.
                            </div>      <div class="mb-3">
                            <div class="row">label for="txtMail" class="form-label">E-Mail</label>
                                <div class="col-md-12">="email" class="form-control" id="txtMail">
                                    <div class="list-group" id="managerRecordList">
                                        <!-- Manager records will be loaded here -->
                                    </div>  <label for="cmbAssignedManager" class="form-label">Verantwortlicher Manager</label>
                                </div>      <select class="form-select" id="cmbAssignedManager" required>
                            </div>              <option value="">Bitte wählen...</option>
                        </div>                  <option value="Manager1">Michael Müller</option>
                    </div>                      <option value="Manager2">Sarah Schmidt</option>
                                                <option value="Manager3">Thomas Weber</option>
                    <!-- Verification Tab -->/select>
                    <div class="tab-pane fade" id="verification" role="tabpanel" aria-labelledby="verification-tab">
                        <div class="container-fluid py-3"> gap-2">
                            <h4>Zur Überprüfung ausstehende Einträge</h4>btn btn-primary" id="btnHRSubmit">
                            <div class="alert alert-warning">bi-check-lg"></i> Absenden
                                <i class="bi bi-exclamation-triangle"></i> Diese Einträge erfordern HR-Prüfung, bevor sie an die IT weitergeleitet werden.
                            </div>      </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="list-group" id="verificationRecordList">
                                        <!-- Records pending verification will be loaded here -->
                                    </div>lass="list-group" id="recordList">
                                </div>  <!-- Records will be loaded here -->
                            </div>      <a href="#" class="list-group-item list-group-item-action">
                        </div>              <div class="d-flex w-100 justify-content-between">
                    </div>                      <h5 class="mb-1">Max Mustermann</h5>
                                                <span class="state-badge state-new">Neu</span>
                    <!-- IT Tab -->         </div>
                    <div class="tab-pane fade" id="it" role="tabpanel" aria-labelledby="it-tab">>
                        <div class="container-fluid py-3">tum: 01.04.2023</small>
                            <h4>IT-Aufgaben für Onboarding</h4>
                            <div class="alert alert-success">st-group-item list-group-item-action">
                                <i class="bi bi-check-circle"></i> Diese Einträge sind bereit für die IT-Bearbeitung.
                            </div>              <h5 class="mb-1">Anna Fischer</h5>
                            <div class="row">   <span class="state-badge state-manager">Warte auf Manager</span>
                                <div class="col-md-12">
                                    <div class="list-group" id="itRecordList"> Marketing</p>
                                        <!-- IT records will be loaded here -->l>
                                    </div>a>
                                </div>  <a href="#" class="list-group-item list-group-item-action">
                            </div>          <div class="d-flex w-100 justify-content-between">
                            <div class="row mt-3">5 class="mb-1">Jan Schmidt</h5>
                                <div class="col-md-12">lass="state-badge state-hr">Warte auf HR Prüfung</span>
                                    <div class="card">
                                        <div class="card-header bg-primary text-white">
                                            <i class="bi bi-download"></i> Datenexport
                                        </div>
                                        <div class="card-body">
                                            <p>Exportieren Sie abgeschlossene Onboarding-Datensätze für das ONBOARDING Tool:</p>
                                            <button type="button" class="btn btn-primary" id="btnExportCSV">
                                                <i class="bi bi-file-earmark-excel"></i> Als CSV exportieren
                                            </button>
                                        </div>
                                    </div>
                                </div>ne fade" id="manager" role="tabpanel" aria-labelledby="manager-tab">
                            </div>="container-fluid py-3">
                        </div>4>Offene Anfragen für Manager-Input</h4>
                    </div>  <div class="alert alert-info">
                </div>          <i class="bi bi-info-circle"></i> Hier sehen Sie Anträge, die auf Ihre Bearbeitung warten. Bitte fügen Sie die notwendigen Informationen hinzu.
            </main>         </div>
        </div>              <div class="row">
    </div>                      <div class="col-md-12">
                                    <div class="list-group" id="managerRecordList">
    <!-- Modal for record details -->   <!-- Manager records will be loaded here -->
    <div class="modal fade" id="recordModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="recordModalTitle">Mitarbeiter-Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>-- Verification Tab -->
                <div class="modal-body" id="recordModalBody">on" role="tabpanel" aria-labelledby="verification-tab">
                    <!-- Record details will be loaded here -->
                </div>      <h4>Zur Überprüfung ausstehende Einträge</h4>iv class="card mb-3">
                <div class="modal-footer">ert alert-warning">eader bg-primary text-white">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Schließen</button>, bevor sie an die IT weitergeleitet werden.
                    <button type="button" class="btn btn-primary" id="saveRecordChanges">Änderungen speichern</button>
                </div>      <div class="row">  <div class="card-body">
            </div>              <div class="col-md-12">          <div class="workflow-container">
        </div>                      <div class="list-group" id="verificationRecordList">                  <div class="workflow-step" id="workflow-step-1">
    </div>                              <!-- Records pending verification will be loaded here -->                          <div class="workflow-icon"><i class="bi bi-1-circle"></i></div>
                                    <strong>HR Eingabe</strong>                                    </div>
    <!-- Manager Form Modal --> </div> </div>
    <div class="modal fade" id="managerFormModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">ass="workflow-icon"><i class="bi bi-2-circle"></i></div>
            <div class="modal-content">rong>Manager Angaben</strong>
                <div class="modal-header">
                    <h5 class="modal-title" id="managerModalTitle">Manager-Eingabe</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>              <strong>HR Prüfung</strong>  <div class="container-fluid py-3">
                <div class="modal-body">n für Onboarding</h4>
                    <form id="managerForm">"workflow-step" id="workflow-step-4">rt alert-success">fo alert alert-info mb-3">
                        <input type="hidden" id="managerRecordId">class="bi bi-4-circle"></i></div> Diese Einträge sind bereit für die IT-Bearbeitung.
                        <div class="mb-3">g>IT Einrichtung</strong>:</strong> Als Abteilungsleiter legen Sie hier die Ausstattung und Zugänge für den neuen Mitarbeiter fest.
                            <label for="managerPosition" class="form-label">Position</label>
                            <input type="text" class="form-control" id="managerPosition" required>
                        </div>      <div class="workflow-icon"><i class="bi bi-check-circle"></i></div>      <div class="list-group" id="itRecordList"> type="hidden" id="managerRecordId">
                        <div class="mb-3">g>Abgeschlossen</strong>-- IT records will be loaded here -->
                            <label for="managerDepartment" class="form-label">Abteilung</label>
                            <select class="form-select" id="managerDepartment" required>
                                <option value="">Bitte wählen...</option>
                                <option value="IT">IT</option>
                                <option value="HR">Personalabteilung</option>
                                <option value="Finance">Finanzen</option>
                                <option value="Marketing">Marketing</option>">">Abteilung <span class="text-danger">*</span></label>
                                <option value="Sales">Vertrieb</option>
                            </select>ue="">Bitte wählen...</option>
                        </div>dal-footer">          <div class="card-body">  <option value="IT">IT</option>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Schließen</button>  <p>Exportieren Sie abgeschlossene Onboarding-Datensätze für das ONBOARDING Tool:</p>lue="HR">Personalabteilung</option>
                    <button type="button" class="btn btn-primary" id="saveRecordChanges">Änderungen speichern</button>SV">
                </div>V exportieren
            </div>              </button>  <option value="Sales">Vertrieb</option>
        </div>div>
    </div>

    <!-- Manager Form Modal -->
    <div class="modal fade" id="managerFormModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="managerModalTitle">Manager-Eingabe</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="managerForm">
                        <input type="hidden" id="managerRecordId">
                        <div class="mb-3">
                            <label for="managerPosition" class="form-label">Position</label>
                            <input type="text" class="form-control" id="managerPosition" required>
                        </div>
                        <div class="mb-3">
                            <label for="managerDepartment" class="form-label">Abteilung</label>
                            <select class="form-select" id="managerDepartment" required>
                                <option value="">Bitte wählen...</option>
                                <option value="IT">IT</option>
                                <option value="HR">Personalabteilung</option>
                                <option value="Finance">Finanzen</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Sales">Vertrieb</option>
                            </select>
                            </select>
                        <div class="mb-3">
                            <label for="managerPersonalNumber" class="form-label">Personalnummer</label>
                            <input type="text" class="form-control" id="managerPersonalNumber">
                        </div>
                        <div class="mb-3">
                            <label for="managerTermination" class="form-label">Vertragslaufzeit bis</label>
                            <input type="date" class="form-control" id="managerTermination">
                        </div>
                        <div class="mb-3">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="managerTL">
                                <label class="form-check-label" for="managerTL">Teamleiter</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="managerAL">
                                <label class="form-check-label" for="managerAL">Abteilungsleiter</label>
                            </div>
                        </div>
                        
                        <h5 class="mt-4">Software & Zugänge</h5>
                        <div class="mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Software</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="managerSoftwareSage">
                                    <label class="form-check-label" for="managerSoftwareSage">Sage</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="managerSoftwareGenesis">
                                    <label class="form-check-label" for="managerSoftwareGenesis">Genesis</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="managerSoftwareOffice">
                                    <label class="form-check-label" for="managerSoftwareOffice">Microsoft Office</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Zugänge</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="managerZugangLizenzmanager">
                                    <label class="form-check-label" for="managerZugangLizenzmanager">Lizenzmanager</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="managerZugangMS365">
                                    <label class="form-check-label" for="managerZugangMS365">MS365</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="managerZugriffe" class="form-label">Weitere Zugriffe (Gruppen, Ordner, Terminalserver)</label>
                            <textarea class="form-control" id="managerZugriffe" rows="2"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="managerEquipment" class="form-label">Ausstattung <span class="text-danger">*</span></label>
                            <select class="form-select" id="managerEquipment" required>
                                <option value="">Bitte wählen...</option>
                                <option value="Notebook Standard">Notebook Standard</option>
                                <option value="Notebook Entwickler">Notebook Entwickler</option>
                                <option value="Desktop PC Standard">Desktop PC Standard</option>
                                <option value="Desktop PC High-End">Desktop PC High-End</option>
                        <div class="mb-3">
                            <label for="managerRoomLocation" class="form-label">Arbeitsplatz</label>
                            <input type="text" class="form-control" id="managerRoomLocation" placeholder="z.B. Raum A-101, Platz 3">
                        </div>
                        
                        <div class="mb-3">
                            <label for="managerNotes" class="form-label">Notizen</label>
                            <textarea class="form-control" id="managerNotes" rows="3" placeholder="Besondere Anforderungen oder zusätzliche Informationen"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="button" class="btn btn-primary" id="btnManagerSubmit">
                        <i class="bi bi-check-lg"></i> Absenden
                    </button>
                </div>
            </div>
        </div>
    </div>
            </div>
        </div>
    </div>
    <!-- IT Checklist Modal -->
    <div class="modal fade" id="itChecklistModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="itModalTitle">IT-Checkliste</h5>
                            <div class="list-group-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkADAccount" required>
                                    <label class="form-check-label" for="checkADAccount">AD Account erstellen</label>
                                </div>
                            </div>
                            <div class="list-group-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkMailbox">
                                    <label class="form-check-label" for="checkMailbox">Mailbox konfigurieren</label>
                                </div>
                            </div>
                            <div class="list-group-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkPermissions">
                                    <label class="form-check-label" for="checkPermissions">Berechtigungen einrichten</label>
                                </div>
                            </div>
                            <div class="list-group-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkHardware">
                                    <label class="form-check-label" for="checkHardware">Hardware vorbereiten</label>
                                </div>
                            </div>
                            <div class="list-group-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkSoftware">
                                    <label class="form-check-label" for="checkSoftware">Software installieren</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="itNotes" class="form-label">IT-Hinweise</label>
                        <textarea class="form-control" id="itNotes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    <button type="button" class="btn btn-primary" id="btnITComplete">Abschließen</button>
                </div>
            </div>
        </div>
    </div>
                        <h5>Checkliste</h5>es" class="form-label">Notizen</label>
                        <div class="list-group" id="itDynamicChecklist">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        const apiBaseUrl = window.location.origin + '/api/onboarding'; // Base URL for API calls
        let currentUser = null;
        let userRole = null;
        let authToken = null;
        
        // Authentication functions
        async function checkAuthentication() {
                            <div class="list-group-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkMailbox">
                                    <label class="form-check-label" for="checkMailbox">Mailbox konfigurieren</label>      <div class="list-group mb-3" id="itSoftwareChecklist">              <input class="form-check-input" type="checkbox" id="checkMailbox">dal-dialog modal-lg">
                                </div>tware checklist items will be added here dynamically -->el class="form-check-label" for="checkMailbox">Mailbox konfigurieren</label>
                            </div>
                            <div class="list-group-item">
                                <div class="form-check">shield-lock"></i> Zugänge</h6>="modal" aria-label="Close"></button>R-Mitarbeiter prüfen Sie die Angaben des Abteilungsleiters und geben den Vorgang für die IT-Abteilung frei.
                                    <input class="form-check-input" type="checkbox" id="checkPermissions">  <div class="list-group mb-3" id="itAccessChecklist">      <div class="form-check">
                                    <label class="form-check-label" for="checkPermissions">Berechtigungen einrichten</label>            <!-- Access checklist items will be added here dynamically -->                <input class="form-check-input" type="checkbox" id="checkPermissions"> class="modal-body"><input type="hidden" id="hrVerificationRecordId">
                                </div>n einrichten</label>
                            </div>
                        </div>  <h6 class="mt-3 mb-2"><i class="bi bi-folder2-open"></i> Zusätzliche Zugriffe</h6>  </div>-- Employee info will be loaded here -->iv class="card-header bg-primary text-white">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        const apiBaseUrl = window.location.origin + '/api/onboarding'; // Base URL for API calls
        let currentUser = null;
        let userRole = null;
        let authToken = null;
        
        // Authentication functions
        async function checkAuthentication() {
            // Check for existing token in sessionStorage
            authToken = sessionStorage.getItem('authToken');
            
            if (authToken) {
                try {
                    // Validate token with the server
                    const response = await fetch(`${apiBaseUrl}/validateToken`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const userData = await response.json();
                        
                        // Set current user data
                        currentUser = userData.username;
                        userRole = userData.role;
                        
                        // Update UI with user info
                        document.getElementById('currentUser').textContent = currentUser;
                        document.getElementById('userRole').textContent = userRole;
                        
                        // Load initial data
                        loadRecords();
                        return true;
                    } else {
                        // Token invalid, clear it
                        sessionStorage.removeItem('authToken');
                        showLoginForm();
                        return false;
                    }
                } catch (error) {
                    console.error('Error validating token:', error);
                    showLoginForm();
                    return false;
                }
            } else {
                // No token found, show login form
                showLoginForm();
                return false;
            }
        }
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables class="alert alert-info">nManagerInfo" class="mb-4">
        const apiBaseUrl = window.location.origin + '/api/onboarding'; // Base URL for API calls-circle"></i> Nach Bestätigung wird die IT-Abteilung über einen neuen Onboarding-Prozess im Ticketsystem informiert.
        let currentUser = null; URL for API calls
        let userRole = null;
        let authToken = null;modal-footer">.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>ss="mb-3 form-check">
        tn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
        // Authentication functionsy" id="btnHRVerify">Bestätigen und an IT weiterleiten</button>
        async function checkAuthentication() {onboarding'; // Base URL for API calls
            // Check for existing token in sessionStorage
            authToken = sessionStorage.getItem('authToken');for existing token in sessionStoragediv class="mb-3">
            r="hrVerificationNotes" class="form-label">Prüfungshinweise</label>
            if (authToken) {
                try {r.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
                    // Validate token with the server
                    const response = await fetch(`${apiBaseUrl}/validateToken`, { variableseck for existing token in sessionStorage   // Validate token with the server   <div class="alert alert-info">
                        method: 'GET',eUrl = window.location.origin + '/api/onboarding'; // Base URL for API callsn = sessionStorage.getItem('authToken');const response = await fetch(`${apiBaseUrl}/validateToken`, {    <i class="bi bi-info-circle"></i> Nach Bestätigung wird die IT-Abteilung über einen neuen Onboarding-Prozess im Ticketsystem informiert.
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'ation': `Bearer ${authToken}`,odal-footer">
                        }  // Validate token with the server               'Content-Type': 'application/json'       <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                    });/ Authentication functions           const response = await fetch(`${apiBaseUrl}/validateToken`, {               }           <button type="button" class="btn btn-primary" id="btnHRVerify">Bestätigen und an IT weiterleiten</button>
                    async function checkAuthentication() {                method: 'GET',            });        </div>
                    if (response.ok) {token in sessionStorage
                        const userData = await response.json();oken');${authToken}`,
                        
                        // Set current user data
                        currentUser = userData.username;
                        userRole = userData.role;e server
                        teToken`, {
                        // Update UI with user info
                        document.getElementById('currentUser').textContent = currentUser;
                        document.getElementById('userRole').textContent = userRole;n}`,urrentUser;
                                    'Content-Type': 'application/json'        currentUser = userData.username;        document.getElementById('userRole').textContent = userRole;Token = null;
                        // Load initial data
                        loadRecords();
                        return true;
                    } else {tent = currentUser;
                        // Token invalid, clear it
                        sessionStorage.removeItem('authToken');
                        showLoginForm();
                        return false;me;
                    }
                } catch (error) {
                    console.error('Error validating token:', error);
                    showLoginForm();
                    return false;tById('userRole').textContent = userRole;er ${authToken}`,
                }
            } else {
                // No token found, show login form
                showLoginForm();ing token:', error);gin form
                return false;
            }
        }
        
        function showLoginForm() {
            // Create login modal if it doesn't exist
            if (!document.getElementById('loginModal')) {
                const loginModal = document.createElement('div');r validating token:', error);info
                loginModal.className = 'modal fade';);div');etElementById('currentUser').textContent = currentUser;
                loginModal.id = 'loginModal';se;nt.getElementById('userRole').textContent = userRole;
                loginModal.setAttribute('data-bs-backdrop', 'static');id = 'loginModal';
                loginModal.setAttribute('data-bs-keyboard', 'false'); {ate login modal if it doesn't existginModal.setAttribute('data-bs-backdrop', 'static');      // Load initial data
                loginModal.tabIndex = -1;// No token found, show login form!document.getElementById('loginModal')) {loginModal.setAttribute('data-bs-keyboard', 'false');        loadRecords();
                loginModal.setAttribute('aria-hidden', 'true');
                return false;loginModal.className = 'modal fade';loginModal.setAttribute('aria-hidden', 'true');    } else {
                loginModal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-content">alog">;
                            <div class="modal-header">wLoginForm() {nModal.tabIndex = -1;    <div class="modal-content">    return false;
                                <h5 class="modal-title">easyONBOARDING Login</h5>
                            </div>
                            <div class="modal-body">
                                <form id="loginForm">nModal.className = 'modal fade';<div class="modal-dialog">        <div class="modal-body">showLoginForm();
                                    <div class="alert alert-danger d-none" id="loginError"></div>l.id = 'loginModal';div class="modal-content">       <form id="loginForm">n false;
                                    <div class="mb-3">
                                        <label for="username" class="form-label">Benutzername</label>ta-bs-keyboard', 'false');modal-title">easyONBOARDING Login</h5>ass="mb-3">
                                        <input type="text" class="form-control" id="username" required>-1;abel for="username" class="form-label">Benutzername</label>w login form
                                    </div>"username" required>
                                    <div class="mb-3">ginForm">      </div>
                                        <label for="password" class="form-label">Passwort</label>
                                        <input type="password" class="form-control" id="password" required>ass="modal-dialog">         <div class="mb-3">             <label for="password" class="form-label">Passwort</label>
                                    </div><div class="modal-content">                <label for="username" class="form-label">Benutzername</label>                <input type="password" class="form-control" id="password" required>
                                    <div class="mb-3 form-check">dal-header">nput type="text" class="form-control" id="username" required>
                                        <input type="checkbox" class="form-check-input" id="rememberMe">OARDING Login</h5>
                                        <label class="form-check-label" for="rememberMe">Angemeldet bleiben</label></div>        <div class="mb-3">            <input type="checkbox" class="form-check-input" id="rememberMe">tElementById('loginModal')) {
                                    </div>body"> for="password" class="form-label">Passwort</label> class="form-check-label" for="rememberMe">Angemeldet bleiben</label>eateElement('div');
                                    <div class="d-grid gap-2">">="password" class="form-control" id="password" required>
                                        <button type="submit" class="btn btn-primary">Anmelden</button>id="loginError"></div>
                                    </div>        <div class="mb-3">        <div class="mb-3 form-check">            <button type="submit" class="btn btn-primary">Anmelden</button>etAttribute('data-bs-backdrop', 'static');
                                </form>el for="username" class="form-label">Benutzername</label>ut type="checkbox" class="form-check-input" id="rememberMe">bs-keyboard', 'false');
                            </div>t" class="form-control" id="username" required>rm-check-label" for="rememberMe">Angemeldet bleiben</label>
                        </div>
                    </div>        <div class="mb-3">        <div class="d-grid gap-2">v>
                `;<label for="password" class="form-label">Passwort</label><button type="submit" class="btn btn-primary">Anmelden</button>
                ord" required>
                document.body.appendChild(loginModal);
                        <div class="mb-3 form-check"></div>y.appendChild(loginModal);<div class="modal-header">
                // Add event listener for form submission type="checkbox" class="form-check-input" id="rememberMe">
                document.getElementById('loginForm').addEventListener('submit', async function(e) {
                    e.preventDefault();unction(e) {y">
                            <div class="d-grid gap-2">   <form id="loginForm">
                    const username = document.getElementById('username').value;type="submit" class="btn btn-primary">Anmelden</button>odal);d="loginError"></div>
                    const password = document.getElementById('password').value;me').value;lass="mb-3">
                                </form>tener for form submissionrd = document.getElementById('password').value;        <label for="username" class="form-label">Benutzername</label>
                            </div>tener('submit', async function(e) {rememberMe').checked;="form-control" id="username" required>
                        </div>
                    </div>
                `; username = document.getElementById('username').value;onst response = await fetch(`${apiBaseUrl}/login`, {               <label for="password" class="form-label">Passwort</label>
                document.getElementById('password').value;POST',   <input type="password" class="form-control" id="password" required>
                document.body.appendChild(loginModal);mberMe').checked;
                
                // Add event listener for form submission
                document.getElementById('loginForm').addEventListener('submit', async function(e) {   const response = await fetch(`${apiBaseUrl}/login`, {       body: JSON.stringify({ username, password, rememberMe })                   <label class="form-check-label" for="rememberMe">Angemeldet bleiben</label>
                    e.preventDefault();         method: 'POST',     });                 </div>
                                   headers: {                                  <div class="d-grid gap-2">
                    const username = document.getElementById('username').value;                    'Content-Type': 'application/json'            if (response.ok) {                            <button type="submit" class="btn btn-primary">Anmelden</button>
                    const password = document.getElementById('password').value; await response.json(); </div>
                    const rememberMe = document.getElementById('rememberMe').checked;
                    ken
                    try {= data.token;
                        const response = await fetch(`${apiBaseUrl}/login`, {         if (response.ok) {             sessionStorage.setItem('authToken', authToken);     </div>
                            method: 'POST',nst data = await response.json();
                            headers: {                                      // Set user data       
                                'Content-Type': 'application/json'                    // Store the token                    currentUser = data.username;        document.body.appendChild(loginModal);
                            }, authToken = data.token; userRole = data.role;
                            body: JSON.stringify({ username, password, rememberMe })ge.setItem('authToken', authToken);ssion
                        }); function(e) {
                        Set user dataument.getElementById('currentUser').textContent = currentUser;fault();
                        if (response.ok) {currentUser = data.username;document.getElementById('userRole').textContent = userRole;
                            const data = await response.json();                userRole = data.role;                        const username = document.getElementById('username').value;
                            document.getElementById('password').value;
                            // Store the token// Update UIconst modalInstance = bootstrap.Modal.getInstance(document.getElementById('loginModal'));memberMe = document.getElementById('rememberMe').checked;
                            authToken = data.token;                   document.getElementById('currentUser').textContent = currentUser;                   modalInstance.hide();           
                            sessionStorage.setItem('authToken', authToken);                    document.getElementById('userRole').textContent = userRole;                                try {
                            datase = await fetch(`${apiBaseUrl}/login`, {
                            // Set user data
                            currentUser = data.username;           const modalInstance = bootstrap.Modal.getInstance(document.getElementById('loginModal'));       } else {           headers: {
                            userRole = data.role;nse.json();plication/json'
                            meldung fehlgeschlagen';
                            // Update UI
                            document.getElementById('currentUser').textContent = currentUser;
                            document.getElementById('userRole').textContent = userRole;
                            
                            // Close the modal            document.getElementById('loginError').textContent = error.message || 'Anmeldung fehlgeschlagen';        document.getElementById('loginError').textContent = 'Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.';            const data = await response.json();
                            const modalInstance = bootstrap.Modal.getInstance(document.getElementById('loginModal'));('loginError').classList.remove('d-none');ginError').classList.remove('d-none');
                            modalInstance.hide();
                            rror) {ata.token;
                            // Load initial dataror);
                            loadRecords();r').textContent = 'Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.';
                        } else {   document.getElementById('loginError').classList.remove('d-none');he login modal       // Set user data
                            const error = await response.json(); }oginModal = new bootstrap.Modal(document.getElementById('loginModal'), {         currentUser = data.username;
                            document.getElementById('loginError').textContent = error.message || 'Anmeldung fehlgeschlagen';});backdrop: 'static',            userRole = data.role;
                            document.getElementById('loginError').classList.remove('d-none');
                        }
                    } catch (error) {
                        console.error('Error during login:', error);trap.Modal(document.getElementById('loginModal'), {tent = userRole;
                        document.getElementById('loginError').textContent = 'Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.';
                        document.getElementById('loginError').classList.remove('d-none');ard: falseut() {       // Close the modal
                    }
                });Modal.show();onStorage.removeItem('authToken');           modalInstance.hide();
            } = null;            
            
            // Show the login modal logout() {        loadRecords();
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'), {
                backdrop: 'static',hToken');.json();
                keyboard: falseentUser = null;     document.getElementById('loginError').textContent = error.message || 'Anmeldung fehlgeschlagen';
            });
            loginModal.show();
        }login pageRecords(filterState = '', searchText = '', fromDate = null, toDate = null, department = '') { (error) {
        oginForm();       console.error('Error during login:', error);
        function logout() { = `${apiBaseUrl}/records?`;        document.getElementById('loginError').textContent = 'Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.';
            // Clear token and user dataor').classList.remove('d-none');
            sessionStorage.removeItem('authToken');
            currentUser = null;ilterState = '', searchText = '', fromDate = null, toDate = null, department = '') {+= `department=${encodeURIComponent(department)}&`;
            userRole = null;
            
            // Redirect to login pagefilterState) url += `state=${filterState}&`;login modal
            showLoginForm();searchText)}&`;l'), {
        }department=${encodeURIComponent(department)}&`;
        romDate=${fromDate.toISOString()}&`;
        // API interaction functionse.toISOString()}&`;{authToken}`,
        async function loadRecords(filterState = '', searchText = '', fromDate = null, toDate = null, department = '') {
            try {
                let url = `${apiBaseUrl}/records?`;
                if (filterState) url += `state=${filterState}&`;
                if (searchText) url += `search=${encodeURIComponent(searchText)}&`;
                if (department) url += `department=${encodeURIComponent(department)}&`;   'Content-Type': 'application/json'f (response.status === 401) {orage.removeItem('authToken');
                if (fromDate) url += `fromDate=${fromDate.toISOString()}&`;}    // Unauthorized - token may have expiredser = null;
                if (toDate) url += `toDate=${toDate.toISOString()}&`;
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {uthorized - token may have expired
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }cords(filterState = '', searchText = '', fromDate = null, toDate = null, department = '') {
                });throw new Error('Failed to load records');t recordList = document.getElementById('recordList');
                
                if (!response.ok) {
                    if (response.status === 401) {&`;
                        // Unauthorized - token may have expired.innerHTML = '<div class="alert alert-info">Keine Einträge gefunden</div>';artment) url += `department=${encodeURIComponent(department)}&`;
                        showLoginForm();t recordList = document.getElementById('recordList');return;fromDate) url += `fromDate=${fromDate.toISOString()}&`;
                        throw new Error('Session expired. Please log in again.');
                    }
                    throw new Error('Failed to load records');ength === 0) {ch(record => {e = await fetch(url, {
                }lert-info">Keine Einträge gefunden</div>';
                
                const records = await response.json();   }       item.className = 'list-group-item list-group-item-action';           'Authorization': `Bearer ${authToken}`,
                                  item.dataset.recordId = record.recordId;               'Content-Type': 'application/json'
                const recordList = document.getElementById('recordList');                records.forEach(record => {                                        }
                recordList.innerHTML = '';ent('a');n workflow state
                   item.href = '#';   let stateClass = '';
                if (records.length === 0) {
                    recordList.innerHTML = '<div class="alert alert-info">Keine Einträge gefunden</div>';ecordId = record.recordId;workflowState) {tatus === 401) {
                    return;ss = 'state-new'; stateName = 'Neu'; break;uthorized - token may have expired
                }statetateName = 'Warte auf Manager'; break;
                auf HR Prüfung'; break;Please log in again.');
                records.forEach(record => {et stateName = '';   case 3: stateClass = 'state-it'; stateName = 'Bereit für IT'; break;
                    const item = document.createElement('a'); switch(record.workflowState) {     case 4: stateClass = 'state-completed'; stateName = 'Abgeschlossen'; break; throw new Error('Failed to load records');
                    item.href = '#';        case 0: stateClass = 'state-new'; stateName = 'Neu'; break;    }}
                    item.className = 'list-group-item list-group-item-action';teClass = 'state-manager'; stateName = 'Warte auf Manager'; break;
                    item.dataset.recordId = record.recordId;e-hr'; stateName = 'Warte auf HR Prüfung'; break;
                    ss = 'state-it'; stateName = 'Bereit für IT'; break;ex w-100 justify-content-between">
                    // Determine state class based on workflow stateschlossen'; break;e}</h5>
                    let stateClass = '';       <span class="state-badge ${stateClass}">${stateName}</span>dList.innerHTML = '';
                    let stateName = '';
                    switch(record.workflowState) {   item.innerHTML = `       <p class="mb-1">${record.position || ''}, ${record.departmentField || ''}</p>f (records.length === 0) {
                        case 0: stateClass = 'state-new'; stateName = 'Neu'; break;        <div class="d-flex w-100 justify-content-between">        <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>    recordList.innerHTML = '<div class="alert alert-info">Keine Einträge gefunden</div>';
                        case 1: stateClass = 'state-manager'; stateName = 'Warte auf Manager'; break;.firstName} ${record.lastName}</h5>
                        case 2: stateClass = 'state-hr'; stateName = 'Warte auf HR Prüfung'; break;            <span class="state-badge ${stateClass}">${stateName}</span>    }
                        case 3: stateClass = 'state-it'; stateName = 'Bereit für IT'; break;
                        case 4: stateClass = 'state-completed'; stateName = 'Abgeschlossen'; break;.departmentField || ''}</p>
                    }startWorkDate).toLocaleDateString('de-DE')}</small>
                        `;    });    item.href = '#';
                    item.innerHTML = `
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>);
                            <span class="state-badge ${stateClass}">${stateName}</span>        openRecordDetails(record.recordId);tch (error) {    // Determine state class based on workflow state
                        </div>
                        <p class="mb-1">${record.position || ''}, ${record.departmentField || ''}</p>
                        <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>tem);
                    `;ak;
                    eak;
                    item.addEventListener('click', function(e) {ecords:', error);dId) {state-hr'; stateName = 'Warte auf HR Prüfung'; break;
                        e.preventDefault();
                        openRecordDetails(record.recordId);
                    });
                    
                    recordList.appendChild(item);ordDetails(recordId) {rization': `Bearer ${authToken}`,HTML = `
                });t-between">
            } catch (error) {
                console.error('Error loading records:', error);
                alert('Fehler beim Laden der Datensätze: ' + error.message);
            }
        }nt-Type': 'application/json'se.status === 401) {>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>
inForm();
        async function openRecordDetails(recordId) { Please log in again.');
            try {
                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {nse.ok) {new Error('Failed to load record details');preventDefault();
                    method: 'GET',  if (response.status === 401) {     openRecordDetails(record.recordId);
                    headers: {
                        'Authorization': `Bearer ${authToken}`,        throw new Error('Session expired. Please log in again.');const record = await response.json();    
                        'Content-Type': 'application/json'
                    }r('Failed to load record details');with record details
                });}document.getElementById('recordModalTitle').textContent = tch (error) {
                stName}`;or loading records:', error);
                if (!response.ok) { await response.json(); Datensätze: ' + error.message);
                    if (response.status === 401) {
                        showLoginForm();
                        throw new Error('Session expired. Please log in again.');
                    }
                    throw new Error('Failed to load record details');
                }
                alBody = document.getElementById('recordModalBody');ction.innerHTML = `d: 'GET',
                const record = await response.json();rHTML = '';s</h5>
                row mb-3">'Authorization': `Bearer ${authToken}`,
                // Populate modal with record detailsls section"col-md-6">pe': 'application/json'
                document.getElementById('recordModalTitle').textContent = 
                    `${record.firstName} ${record.lastName}`;
                /h5>strong>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>
                // Configure modal content based on workflow state and user role
                const modalBody = document.getElementById('recordModalBody');div class="col-md-6">/div>esponse.status === 401) {
                modalBody.innerHTML = '';><strong>Name:</strong> ${record.firstName} ${record.lastName}</p>lass="col-md-6">ginForm();
                    <p><strong>Position:</strong> ${record.position || 'Nicht angegeben'}</p>    <p><strong>Büro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>throw new Error('Session expired. Please log in again.');
                // Add common details section><strong>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>><strong>Telefon:</strong> ${record.phoneNumber || 'Nicht angegeben'}</p>
                const detailsSection = document.createElement('div');cord.startWorkDate).toLocaleDateString('de-DE')}</p>ber || 'Nicht angegeben'}</p>
                detailsSection.innerHTML = `
                    <h5>Details</h5>ss="col-md-6">
                    <div class="row mb-3">/p>
                        <div class="col-md-6">   <p><strong>Telefon:</strong> ${record.phoneNumber || 'Nicht angegeben'}</p>class="mb-3">
                            <p><strong>Name:</strong> ${record.firstName} ${record.lastName}</p>><strong>Mobil:</strong> ${record.mobileNumber || 'Nicht angegeben'}</p>rong>Beschreibung:</strong> ${record.description || 'Keine Beschreibung'}</p>dal with record details
                            <p><strong>Position:</strong> ${record.position || 'Nicht angegeben'}</p>    <p><strong>E-Mail:</strong> ${record.emailAddress || 'Nicht angegeben'}</p>v>.getElementById('recordModalTitle').textContent = 
                            <p><strong>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>astName}`;
                            <p><strong>Startdatum:</strong> ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</p>
                        </div>
                        <div class="col-md-6">rong>Beschreibung:</strong> ${record.description || 'Keine Beschreibung'}</p>ecific sectionsy = document.getElementById('recordModalBody');
                            <p><strong>Büro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>   </div>et actionSection;odalBody.innerHTML = '';
                            <p><strong>Telefon:</strong> ${record.phoneNumber || 'Nicht angegeben'}</p>`;
                            <p><strong>Mobil:</strong> ${record.mobileNumber || 'Nicht angegeben'}</p>d(detailsSection);section
                            <p><strong>E-Mail:</strong> ${record.emailAddress || 'Nicht angegeben'}</p>
                        </div>/ Add role-specific sections       if (record.workflowState === 0) { // NewetailsSection.innerHTML = `
                    </div>let actionSection;            actionSection = createHREditSection(record);    <h5>Details</h5>
                    <div class="mb-3"> Verification
                        <p><strong>Beschreibung:</strong> ${record.description || 'Keine Beschreibung'}</p>
                    </div>ame}</p>
                `;tate === 0) { // NewcreateReadOnlySection('HR Hinweise', record.hrNotes);ion:</strong> ${record.position || 'Nicht angegeben'}</p>
                modalBody.appendChild(detailsSection);reateHREditSection(record);rd.departmentField || 'Nicht angegeben'}</p>
                
                // Add role-specific sections
                let actionSection;
                
                switch(userRole) {
                    case 'HR':      break;      } else {          <p><strong>Mobil:</strong> ${record.mobileNumber || 'Nicht angegeben'}</p>
                        if (record.workflowState === 0) { // New, record.managerNotes);> ${record.emailAddress || 'Nicht angegeben'}</p>
                            actionSection = createHREditSection(record);    case 'Manager':        }        </div>
                        } else if (record.workflowState === 2) { // Pending HR VerificationlowState === 1 && record.assignedManager === currentUser) { // Pending Manager Input
                            actionSection = createHRVerificationSection(record);
                        } else {
                            actionSection = createReadOnlySection('HR Hinweise', record.hrNotes);            actionSection = createReadOnlySection('Manager Hinweise', record.managerNotes);        if (record.workflowState === 3) { // Ready for IT    </div>
                        }
                        break;
                        
                    case 'Manager':
                        if (record.workflowState === 1 && record.assignedManager === currentUser) { // Pending Manager InputState === 3) { // Ready for IT
                            actionSection = createManagerEditSection(record);ction(record);
                        } else {} else { 'Admin':serRole) {
                            actionSection = createReadOnlySection('Manager Hinweise', record.managerNotes);nlySection('IT Hinweise', record.itNotes);
                        }       }       actionSection = createAdminEditSection(record);       if (record.workflowState === 0) { // New
                        break;        break;        break;            actionSection = createHREditSection(record);
                        = 2) { // Pending HR Verification
                    case 'IT':
                        if (record.workflowState === 3) { // Ready for ITmins can edit most thingstion) {e {
                            actionSection = createITEditSection(record);nSection = createAdminEditSection(record);.appendChild(actionSection);ctionSection = createReadOnlySection('HR Hinweise', record.hrNotes);
                        } else {
                            actionSection = createReadOnlySection('IT Hinweise', record.itNotes);
                        }      // Add workflow history section           
                        break;       if (actionSection) {       const historySection = document.createElement('div');           case 'Manager':
                                    modalBody.appendChild(actionSection);        historySection.className = 'mt-4';                if (record.workflowState === 1 && record.assignedManager === currentUser) { // Pending Manager Input
                    case 'Admin':
                        // Admins can edit most things
                        actionSection = createAdminEditSection(record);dge ${getStateClass(record.workflowState)}">${getStateName(record.workflowState)}</span></p>Section('Manager Hinweise', record.managerNotes);
                        break;document.createElement('div'); am:</strong> ${new Date(record.createdDate).toLocaleString('de-DE')}</p>
                }assName = 'mt-4';stellt von:</strong> ${record.createdBy}</p>
                L = `aktualisiert:</strong> ${new Date(record.lastUpdated).toLocaleString('de-DE')}</p>
                if (actionSection) {erlauf</h5>ualisiert von:</strong> ${record.lastUpdatedBy}</p>
                    modalBody.appendChild(actionSection);eClass(record.workflowState)}">${getStateName(record.workflowState)}</span></p>
                }
                ><strong>Erstellt von:</strong> ${record.createdBy}</p>se {
                // Add workflow history sectionetzt aktualisiert:</strong> ${new Date(record.lastUpdated).toLocaleString('de-DE')}</p>buttonSection = createReadOnlySection('IT Hinweise', record.itNotes);
                const historySection = document.createElement('div');/p>
                historySection.className = 'mt-4';
                historySection.innerHTML = `ody.appendChild(historySection);
                    <h5>Workflow-Verlauf</h5>
                    <p><strong>Status:</strong> <span class="state-badge ${getStateClass(record.workflowState)}">${getStateName(record.workflowState)}</span></p>
                    <p><strong>Erstellt am:</strong> ${new Date(record.createdDate).toLocaleString('de-DE')}</p>
                    <p><strong>Erstellt von:</strong> ${record.createdBy}</p>tton.dataset.recordId = record.recordId;serRole === 'IT' && record.workflowState === 3) ||  break;
                    <p><strong>Zuletzt aktualisiert:</strong> ${new Date(record.lastUpdated).toLocaleString('de-DE')}</p>
                    <p><strong>Aktualisiert von:</strong> ${record.lastUpdatedBy}</p>
                `;
                modalBody.appendChild(historySection);serRole === 'Manager' && record.workflowState === 1 && record.assignedManager === currentUser) ||veButton.classList.add('d-none');dalBody.appendChild(actionSection);
                'IT' && record.workflowState === 3) ||
                // Configure save button
                const saveButton = document.getElementById('saveRecordChanges');
                saveButton.dataset.recordId = record.recordId; {modal = new bootstrap.Modal(document.getElementById('recordModal'));historySection = document.createElement('div');
                ssList.add('d-none');e = 'mt-4';
                // Set visibility of save button based on edit permissions
                if ((userRole === 'HR' && (record.workflowState === 0 || record.workflowState === 2)) ||
                    (userRole === 'Manager' && record.workflowState === 1 && record.assignedManager === currentUser) ||w the modal'Fehler beim Laden der Detailinformationen: ' + error.message);><strong>Status:</strong> <span class="state-badge ${getStateClass(record.workflowState)}">${getStateName(record.workflowState)}</span></p>
                    (userRole === 'IT' && record.workflowState === 3) ||bootstrap.Modal(document.getElementById('recordModal'));new Date(record.createdDate).toLocaleString('de-DE')}</p>
                    userRole === 'Admin') {
                    saveButton.classList.remove('d-none');
                } else {e.error('Error loading record details:', error);tions for modal sections><strong>Aktualisiert von:</strong> ${record.lastUpdatedBy}</p>
                    saveButton.classList.add('d-none'); Laden der Detailinformationen: ' + error.message);on(record) {
                }
                
                // Show the modalure save button
                const modal = new bootstrap.Modal(document.getElementById('recordModal'));dal sections</h5> document.getElementById('saveRecordChanges');
                modal.show();
            } catch (error) {
                console.error('Error loading record details:', error);assName = 'mt-4';nput type="text" class="form-control" id="modalFirstName" value="${record.firstName || ''}"> visibility of save button based on edit permissions
                alert('Fehler beim Laden der Detailinformationen: ' + error.message);rd.workflowState === 0 || record.workflowState === 2)) ||
            }
        }
        abel for="modalFirstName" class="form-label">Vorname</label>nput type="text" class="form-control" id="modalLastName" value="${record.lastName || ''}">erRole === 'Admin') {
        // Helper functions for modal sectionsext" class="form-control" id="modalFirstName" value="${record.firstName || ''}">e('d-none');
        function createHREditSection(record) {
            const section = document.createElement('div');ternal ? 'checked' : ''}>
            section.className = 'mt-4';>Nachname</label>ernal">Externer Mitarbeiter</label>
            section.innerHTML = `me" value="${record.lastName || ''}">
                <h5>HR-Bearbeitung</h5>="modalExtCompanyGroup" style="${record.external ? 'display:block' : 'display:none'}">odal
                <div class="mb-3">lass="mb-3 form-check">abel for="modalExtCompany" class="form-label">Externe Firma</label>modal = new bootstrap.Modal(document.getElementById('recordModal'));
                    <label for="modalFirstName" class="form-label">Vorname</label>heckbox" class="form-check-input" id="modalExternal" ${record.external ? 'checked' : ''}>ext" class="form-control" id="modalExtCompany" value="${record.externalCompany || ''}">
                    <input type="text" class="form-control" id="modalFirstName" value="${record.firstName || ''}">arbeiter</label>
                </div>
                <div class="mb-3">lass="mb-3" id="modalExtCompanyGroup" style="${record.external ? 'display:block' : 'display:none'}">abel for="modalDescription" class="form-label">Beschreibung</label>'Fehler beim Laden der Detailinformationen: ' + error.message);
                    <label for="modalLastName" class="form-label">Nachname</label>      <label for="modalExtCompany" class="form-label">Externe Firma</label>      <textarea class="form-control" id="modalDescription" rows="2">${record.description || ''}</textarea>
                    <input type="text" class="form-control" id="modalLastName" value="${record.lastName || ''}">        <input type="text" class="form-control" id="modalExtCompany" value="${record.externalCompany || ''}">    </div>
                </div>
                <div class="mb-3 form-check">-3">="modalOffice" class="form-label">Büro</label>r modal sections
                    <input type="checkbox" class="form-check-input" id="modalExternal" ${record.external ? 'checked' : ''}>/label>="${record.officeRoom || ''}">
                    <label class="form-check-label" for="modalExternal">Externer Mitarbeiter</label>rd.description || ''}</textarea>
                </div></div><div class="mb-3">ion.className = 'mt-4';
                <div class="mb-3" id="modalExtCompanyGroup" style="${record.external ? 'display:block' : 'display:none'}">
                    <label for="modalExtCompany" class="form-label">Externe Firma</label>alue="${record.phoneNumber || ''}">
                    <input type="text" class="form-control" id="modalExtCompany" value="${record.externalCompany || ''}">cord.officeRoom || ''}">
                </div>ss="mb-3">bel for="modalFirstName" class="form-label">Vorname</label>
                <div class="mb-3">div class="mb-3">   <label for="modalMobile" class="form-label">Mobil</label>   <input type="text" class="form-control" id="modalFirstName" value="${record.firstName || ''}">
                    <label for="modalDescription" class="form-label">Beschreibung</label>    <label for="modalPhone" class="form-label">Telefon</label>    <input type="tel" class="form-control" id="modalMobile" value="${record.mobileNumber || ''}"></div>
                    <textarea class="form-control" id="modalDescription" rows="2">${record.description || ''}</textarea>form-control" id="modalPhone" value="${record.phoneNumber || ''}">
                </div>
                <div class="mb-3">iv class="mb-3">  <label for="modalEmail" class="form-label">E-Mail</label>  <input type="text" class="form-control" id="modalLastName" value="${record.lastName || ''}">
                    <label for="modalOffice" class="form-label">Büro</label>        <label for="modalMobile" class="form-label">Mobil</label>        <input type="email" class="form-control" id="modalEmail" value="${record.emailAddress || ''}">    </div>
                    <input type="text" class="form-control" id="modalOffice" value="${record.officeRoom || ''}">type="tel" class="form-control" id="modalMobile" value="${record.mobileNumber || ''}"> form-check">
                </div>       </div>       <div class="mb-3">           <input type="checkbox" class="form-check-input" id="modalExternal" ${record.external ? 'checked' : ''}>
                <div class="mb-3">        <div class="mb-3">            <label for="modalStartDate" class="form-label">Startdatum</label>            <label class="form-check-label" for="modalExternal">Externer Mitarbeiter</label>
                    <label for="modalPhone" class="form-label">Telefon</label>m-label">E-Mail</label>trol" id="modalStartDate" value="${formatDateForInput(record.startWorkDate)}">
                    <input type="tel" class="form-control" id="modalPhone" value="${record.phoneNumber || ''}">l" id="modalEmail" value="${record.emailAddress || ''}">y:block' : 'display:none'}">
                </div>label">Externe Firma</label>
                <div class="mb-3">>odalManager" class="form-label">Verantwortlicher Manager</label>text" class="form-control" id="modalExtCompany" value="${record.externalCompany || ''}">
                    <label for="modalMobile" class="form-label">Mobil</label>artDate" class="form-label">Startdatum</label>-select" id="modalManager">
                    <input type="tel" class="form-control" id="modalMobile" value="${record.mobileNumber || ''}">form-control" id="modalStartDate" value="${formatDateForInput(record.startWorkDate)}"> wählen...</option>
                </div>
                <div class="mb-3">lass="mb-3">select>extarea class="form-control" id="modalDescription" rows="2">${record.description || ''}</textarea>
                    <label for="modalEmail" class="form-label">E-Mail</label> class="form-label">Verantwortlicher Manager</label>
                    <input type="email" class="form-control" id="modalEmail" value="${record.emailAddress || ''}">
                </div>
                <div class="mb-3">  <!-- Manager options will be loaded dynamically -->extarea class="form-control" id="modalHRNotes" rows="2">${record.hrNotes || ''}</textarea>nput type="text" class="form-control" id="modalOffice" value="${record.officeRoom || ''}">
                    <label for="modalStartDate" class="form-label">Startdatum</label>
                    <input type="date" class="form-control" id="modalStartDate" value="${formatDateForInput(record.startWorkDate)}">
                </div>
                <div class="mb-3">abel for="modalHRNotes" class="form-label">HR-Hinweise</label>nt listener for external checkboxnput type="tel" class="form-control" id="modalPhone" value="${record.phoneNumber || ''}">
                    <label for="modalManager" class="form-label">Verantwortlicher Manager</label>      <textarea class="form-control" id="modalHRNotes" rows="2">${record.hrNotes || ''}</textarea>tTimeout(() => {  </div>
                    <select class="form-select" id="modalManager">eckbox = document.getElementById('modalExternal');"mb-3">
                        <option value="">Bitte wählen...</option>   `;       const extCompanyGroup = document.getElementById('modalExtCompanyGroup');           <label for="modalMobile" class="form-label">Mobil</label>
                        <!-- Manager options will be loaded dynamically -->                        <input type="tel" class="form-control" id="modalMobile" value="${record.mobileNumber || ''}">
                    </select>kboxroup) {
                </div>
                <div class="mb-3">= document.getElementById('modalExternal');.style.display = this.checked ? 'block' : 'none';ail" class="form-label">E-Mail</label>
                    <label for="modalHRNotes" class="form-label">HR-Hinweise</label>roup = document.getElementById('modalExtCompanyGroup');ss="form-control" id="modalEmail" value="${record.emailAddress || ''}">
                    <textarea class="form-control" id="modalHRNotes" rows="2">${record.hrNotes || ''}</textarea>
                </div>ox && extCompanyGroup) {
            `;
            
            // Add event listener for external checkbox;
            setTimeout(() => {
                const externalCheckbox = document.getElementById('modalExternal');
                const extCompanyGroup = document.getElementById('modalExtCompanyGroup');
                signedManager);
                if (externalCheckbox && extCompanyGroup) {
                    externalCheckbox.addEventListener('change', function() {
                        extCompanyGroup.style.display = this.checked ? 'block' : 'none';
                    });
                }
                ficationSection(record) {lert alert-info"> class="form-control" id="modalHRNotes" rows="2">${record.hrNotes || ''}</textarea>
                // Load managers for dropdownion = document.createElement('div'); class="bi bi-info-circle"></i> Bitte überprüfen Sie die eingegebenen Informationen und bestätigen Sie diese.
                loadManagersForDropdown('modalManager', record.assignedManager);t-4';
            }, 0);
            
            return section;lass="alert alert-info">abel class="form-check-label" for="modalHRVerified">Von HR überprüft</label>(() => {
        }i-info-circle"></i> Bitte überprüfen Sie die eingegebenen Informationen und bestätigen Sie diese.ent.getElementById('modalExternal');
        
        function createHRVerificationSection(record) {
            const section = document.createElement('div');nput type="checkbox" class="form-check-input" id="modalHRVerified">extarea class="form-control" id="modalVerificationNotes" rows="3">${record.verificationNotes || ''}</textarea>ternalCheckbox && extCompanyGroup) {
            section.className = 'mt-4';form-check-label" for="modalHRVerified">Von HR überprüft</label>istener('change', function() {
            section.innerHTML = `
                <h5>HR-Überprüfung</h5>
                <div class="alert alert-info">inweise</label>
                    <i class="bi bi-info-circle"></i> Bitte überprüfen Sie die eingegebenen Informationen und bestätigen Sie diese.rea class="form-control" id="modalVerificationNotes" rows="3">${record.verificationNotes || ''}</textarea>
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="modalHRVerified">
                    <label class="form-check-label" for="modalHRVerified">Von HR überprüft</label>
                </div>ung</h5>tion;
                <div class="mb-3">Section(record) {
                    <label for="modalVerificationNotes" class="form-label">Überprüfungshinweise</label>
                    <textarea class="form-control" id="modalVerificationNotes" rows="3">${record.verificationNotes || ''}</textarea>
                </div>nerHTML = `ion = document.createElement('div');
            `;
            return section;dalDepartment" class="form-label">Abteilung</label>
        }el">Position</label>tment">
        
        function createManagerEditSection(record) {
            const section = document.createElement('div');="mb-3">ption value="HR" ${record.departmentField === 'HR' ? 'selected' : ''}>Personalabteilung</option>
            section.className = 'mt-4';abel">Abteilung</label>tmentField === 'Finance' ? 'selected' : ''}>Finanzen</option>
            section.innerHTML = `
                <h5>Manager-Bearbeitung</h5>
                <div class="mb-3">ption value="IT" ${record.departmentField === 'IT' ? 'selected' : ''}>IT</option>ct>
                    <label for="modalPosition" class="form-label">Position</label>  <option value="HR" ${record.departmentField === 'HR' ? 'selected' : ''}>Personalabteilung</option>lass="mb-3">
                    <input type="text" class="form-control" id="modalPosition" value="${record.position || ''}">lue="Finance" ${record.departmentField === 'Finance' ? 'selected' : ''}>Finanzen</option>dalVerificationNotes" class="form-label">Überprüfungshinweise</label>
                </div>artmentField === 'Marketing' ? 'selected' : ''}>Marketing</option>rm-label">Personalnummer</label>rificationNotes" rows="3">${record.verificationNotes || ''}</textarea>
                <div class="mb-3">
                    <label for="modalDepartment" class="form-label">Abteilung</label>
                    <select class="form-select" id="modalDepartment">-3">;
                        <option value="">Bitte wählen...</option>/label>
                        <option value="IT" ${record.departmentField === 'IT' ? 'selected' : ''}>IT</option>
                        <option value="HR" ${record.departmentField === 'HR' ? 'selected' : ''}>Personalabteilung</option>${record.personalNumber || ''}">
                        <option value="Finance" ${record.departmentField === 'Finance' ? 'selected' : ''}>Finanzen</option>-3">= document.createElement('div');
                        <option value="Marketing" ${record.departmentField === 'Marketing' ? 'selected' : ''}>Marketing</option>lass="mb-3">iv class="form-check form-check-inline">assName = 'mt-4';
                        <option value="Sales" ${record.departmentField === 'Sales' ? 'selected' : ''}>Vertrieb</option>dalTermination" class="form-label">Vertragslaufzeit bis</label>ss="form-check-input" type="checkbox" id="modalTL" ${record.tl ? 'checked' : ''}>
                    </select>{formatDateForInput(record.ablaufdatum)}">
                </div>
                <div class="mb-3">lass="mb-3">iv class="form-check form-check-inline">abel for="modalPosition" class="form-label">Position</label>
                    <label for="modalPersonalNumber" class="form-label">Personalnummer</label>      <div class="form-check form-check-inline">          <input class="form-check-input" type="checkbox" id="modalAL" ${record.al ? 'checked' : ''}>      <input type="text" class="form-control" id="modalPosition" value="${record.position || ''}">
                    <input type="text" class="form-control" id="modalPersonalNumber" value="${record.personalNumber || ''}">put class="form-check-input" type="checkbox" id="modalTL" ${record.tl ? 'checked' : ''}>bel class="form-check-label" for="modalAL">Abteilungsleiter</label>
                </div>               <label class="form-check-label" for="modalTL">Teamleiter</label>           </div>       <div class="mb-3">
                <div class="mb-3">            </div>        </div>            <label for="modalDepartment" class="form-label">Abteilung</label>
                    <label for="modalTermination" class="form-label">Vertragslaufzeit bis</label>m-check-inline">epartment">
                    <input type="date" class="form-control" id="modalTermination" value="${formatDateForInput(record.ablaufdatum)}">pe="checkbox" id="modalAL" ${record.al ? 'checked' : ''}>form-label">Manager-Hinweise</label>option>
                </div>orm-check-label" for="modalAL">Abteilungsleiter</label>rm-control" id="modalManagerNotes" rows="3">${record.managerNotes || ''}</textarea>IT" ${record.departmentField === 'IT' ? 'selected' : ''}>IT</option>
                <div class="mb-3">.departmentField === 'HR' ? 'selected' : ''}>Personalabteilung</option>
                    <div class="form-check form-check-inline">Finance" ${record.departmentField === 'Finance' ? 'selected' : ''}>Finanzen</option>
                        <input class="form-check-input" type="checkbox" id="modalTL" ${record.tl ? 'checked' : ''}>ntField === 'Marketing' ? 'selected' : ''}>Marketing</option>
                        <label class="form-check-label" for="modalTL">Teamleiter</label>
                    </div>es || ''}</textarea>d.softwareSage ? 'checked' : ''}>
                    <div class="form-check form-check-inline">  <label class="form-check-label" for="modalSoftwareSage">Sage</label>
                        <input class="form-check-input" type="checkbox" id="modalAL" ${record.al ? 'checked' : ''}>ugänge</h5>
                        <label class="form-check-label" for="modalAL">Abteilungsleiter</label>
                    </div>Number || ''}">
                </div>  <input class="form-check-input" type="checkbox" id="modalSoftwareSage" ${record.softwareSage ? 'checked' : ''}>  <label class="form-check-label" for="modalSoftwareGenesis">Genesis</label>
                <div class="mb-3">ss="form-check-label" for="modalSoftwareSage">Sage</label>
                    <label for="modalManagerNotes" class="form-label">Manager-Hinweise</label>
                    <textarea class="form-control" id="modalManagerNotes" rows="3">${record.managerNotes || ''}</textarea>
                </div>  <input class="form-check-input" type="checkbox" id="modalSoftwareGenesis" ${record.softwareGenesis ? 'checked' : ''}>iv class="form-check form-check-inline">
                <h5 class="mt-4">Software & Zugänge</h5>ss="form-check-label" for="modalSoftwareGenesis">Genesis</label>ss="form-check-input" type="checkbox" id="modalZugangLizenzmanager" ${record.zugangLizenzmanager ? 'checked' : ''}>
                <div class="mb-3">
                    <div class="form-check form-check-inline"> ${record.tl ? 'checked' : ''}>
                        <input class="form-check-input" type="checkbox" id="modalSoftwareSage" ${record.softwareSage ? 'checked' : ''}>dalTL">Teamleiter</label>
                        <label class="form-check-label" for="modalSoftwareSage">Sage</label>k-inline">ut" type="checkbox" id="modalZugangMS365" ${record.zugangMS365 ? 'checked' : ''}>
                    </div>" ${record.zugangLizenzmanager ? 'checked' : ''}>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="modalSoftwareGenesis" ${record.softwareGenesis ? 'checked' : ''}>" for="modalAL">Abteilungsleiter</label>
                        <label class="form-check-label" for="modalSoftwareGenesis">Genesis</label>="form-check form-check-inline">-3">
                    </div>t" type="checkbox" id="modalZugangMS365" ${record.zugangMS365 ? 'checked' : ''}>"form-label">Weitere Zugriffe</label>
                </div>el" for="modalZugangMS365">MS365</label>d="modalZugriffe" rows="2">${record.zugriffe || ''}</textarea>
                <div class="mb-3">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="modalZugangLizenzmanager" ${record.zugangLizenzmanager ? 'checked' : ''}>
                        <label class="form-check-label" for="modalZugangLizenzmanager">Lizenzmanager</label>="modalZugriffe" class="form-label">Weitere Zugriffe</label></h5>
                    </div>="modalZugriffe" rows="2">${record.zugriffe || ''}</textarea>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="modalZugangMS365" ${record.zugangMS365 ? 'checked' : ''}>
                        <label class="form-check-label" for="modalZugangMS365">MS365</label>
                    </div>
                </div>form-check-inline">
                <div class="mb-3">ox" id="modalSoftwareGenesis" ${record.softwareGenesis ? 'checked' : ''}>
                    <label for="modalZugriffe" class="form-label">Weitere Zugriffe</label>div');rm-check-input" id="modalAccountCreated" ${record.accountCreated ? 'checked' : ''}>el" for="modalSoftwareGenesis">Genesis</label>
                    <textarea class="form-control" id="modalZugriffe" rows="2">${record.zugriffe || ''}</textarea>
                </div>
            `;</h5>orm-check">
            return section;-3 form-check">e="checkbox" class="form-check-input" id="modalEquipmentReady" ${record.equipmentReady ? 'checked' : ''}>="form-check form-check-inline">
        }m-check-input" id="modalAccountCreated" ${record.accountCreated ? 'checked' : ''}>or="modalEquipmentReady">Ausstattung bereit</label>t" type="checkbox" id="modalZugangLizenzmanager" ${record.zugangLizenzmanager ? 'checked' : ''}>
        for="modalAccountCreated">Account erstellt</label>ger">Lizenzmanager</label>
        function createITEditSection(record) {
            const section = document.createElement('div');
            section.className = 'mt-4';heckbox" class="form-check-input" id="modalEquipmentReady" ${record.equipmentReady ? 'checked' : ''}>s="form-control" id="modalITNotes" rows="3">${record.itNotes || ''}</textarea>ss="form-check-input" type="checkbox" id="modalZugangMS365" ${record.zugangMS365 ? 'checked' : ''}>
            section.innerHTML = `ss="form-check-label" for="modalEquipmentReady">Ausstattung bereit</label>form-check-label" for="modalZugangMS365">MS365</label>
                <h5>IT-Bearbeitung</h5>-3">
                <div class="mb-3 form-check">lass="mb-3">abel class="form-label">IT-Checkliste</label>
                    <input type="checkbox" class="form-check-input" id="modalAccountCreated" ${record.accountCreated ? 'checked' : ''}>      <label for="modalITNotes" class="form-label">IT-Hinweise</label>      <div class="list-group">  <div class="mb-3">
                    <label class="form-check-label" for="modalAccountCreated">Account erstellt</label>ea class="form-control" id="modalITNotes" rows="3">${record.itNotes || ''}</textarea>v class="list-group-item">for="modalZugriffe" class="form-label">Weitere Zugriffe</label>
                </div>       </div>                   <div class="form-check">           <textarea class="form-control" id="modalZugriffe" rows="2">${record.zugriffe || ''}</textarea>
                <div class="mb-3 form-check">        <div class="mb-3">                        <input class="form-check-input" type="checkbox" id="checkADAccount">        </div>
                    <input type="checkbox" class="form-check-input" id="modalEquipmentReady" ${record.equipmentReady ? 'checked' : ''}>Checkliste</label>m-check-label" for="checkADAccount">AD Account erstellen</label>
                    <label class="form-check-label" for="modalEquipmentReady">Ausstattung bereit</label>
                </div>t-group-item">
                <div class="mb-3">class="form-check">s="list-group-item">
                    <label for="modalITNotes" class="form-label">IT-Hinweise</label>-check-input" type="checkbox" id="checkADAccount">">
                    <textarea class="form-control" id="modalITNotes" rows="3">${record.itNotes || ''}</textarea>m-check-label" for="checkADAccount">AD Account erstellen</label>m-check-input" type="checkbox" id="checkMailbox">t('div');
                </div>
                <div class="mb-3">  </div>      </div>nerHTML = `
                    <label class="form-label">IT-Checkliste</label>="list-group-item">>
                    <div class="list-group">
                        <div class="list-group-item">x" id="checkMailbox">accountCreated ? 'checked' : ''}>
                            <div class="form-check">en</label>
                                <input class="form-check-input" type="checkbox" id="checkADAccount">
                                <label class="form-check-label" for="checkADAccount">AD Account erstellen</label>
                            </div>
                        </div>
                        <div class="list-group-item">   <input class="form-check-input" type="checkbox" id="checkPermissions">div class="form-check">
                            <div class="form-check">          <label class="form-check-label" for="checkPermissions">Berechtigungen einrichten</label>          <input class="form-check-input" type="checkbox" id="checkHardware">lass="mb-3">
                                <input class="form-check-input" type="checkbox" id="checkMailbox">abel class="form-check-label" for="checkHardware">Hardware vorbereiten</label>dalITNotes" class="form-label">IT-Hinweise</label>
                                <label class="form-check-label" for="checkMailbox">Mailbox konfigurieren</label>
                            </div>
                        </div>      <div class="form-check">  <div class="list-group-item">lass="mb-3">
                        <div class="list-group-item">nput class="form-check-input" type="checkbox" id="checkHardware">lass="form-check">form-label">IT-Checkliste</label>
                            <div class="form-check">Hardware vorbereiten</label>checkSoftware">
                                <input class="form-check-input" type="checkbox" id="checkPermissions">
                                <label class="form-check-label" for="checkPermissions">Berechtigungen einrichten</label>>/div>div class="form-check">
                            </div>
                        </div>
                        <div class="list-group-item">   <input class="form-check-input" type="checkbox" id="checkSoftware">
                            <div class="form-check">          <label class="form-check-label" for="checkSoftware">Software installieren</label>
                                <input class="form-check-input" type="checkbox" id="checkHardware">              </div>turn section;          <div class="list-group-item">
                                <label class="form-check-label" for="checkHardware">Hardware vorbereiten</label>            </div>             <div class="form-check">
                            </div>
                        </div>n(record) {  <label class="form-check-label" for="checkMailbox">Mailbox konfigurieren</label>
                        <div class="list-group-item">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="checkSoftware">
                                <label class="form-check-label" for="checkSoftware">Software installieren</label>
                            </div>AdminEditSection(record) {ass="alert alert-warning">         <input class="form-check-input" type="checkbox" id="checkPermissions">
                        </div> section = document.createElement('div');   <i class="bi bi-exclamation-triangle"></i> Achtung: Sie bearbeiten diesen Datensatz als Administrator.               <label class="form-check-label" for="checkPermissions">Berechtigungen einrichten</label>
                    </div>ion.className = 'mt-4';</div>            </div>
                </div>
            `;beitung</h5>dminWorkflowState" class="form-label">Workflow-Status</label>st-group-item">
            return section;
        }</i> Achtung: Sie bearbeiten diesen Datensatz als Administrator.wState === 0 ? 'selected' : ''}>Neu</option>nput" type="checkbox" id="checkHardware">
        <option value="1" ${record.workflowState === 1 ? 'selected' : ''}>Warte auf Manager</option>         <label class="form-check-label" for="checkHardware">Hardware vorbereiten</label>
        function createAdminEditSection(record) {div class="mb-3">       <option value="2" ${record.workflowState === 2 ? 'selected' : ''}>Warte auf HR Prüfung</option>           </div>
            const section = document.createElement('div');  <label for="modalAdminWorkflowState" class="form-label">Workflow-Status</label>      <option value="3" ${record.workflowState === 3 ? 'selected' : ''}>Bereit für IT</option>      </div>
            section.className = 'mt-4';        <select class="form-select" id="modalAdminWorkflowState">            <option value="4" ${record.workflowState === 4 ? 'selected' : ''}>Abgeschlossen</option>            <div class="list-group-item">
            section.innerHTML = `tion value="0" ${record.workflowState === 0 ? 'selected' : ''}>Neu</option>t> <div class="form-check">
                <h5>Administrator-Bearbeitung</h5>               <option value="1" ${record.workflowState === 1 ? 'selected' : ''}>Warte auf Manager</option>       </div>                       <input class="form-check-input" type="checkbox" id="checkSoftware">
                <div class="alert alert-warning">                <option value="2" ${record.workflowState === 2 ? 'selected' : ''}>Warte auf HR Prüfung</option>        <div class="mb-3">                        <label class="form-check-label" for="checkSoftware">Software installieren</label>
                    <i class="bi bi-exclamation-triangle"></i> Achtung: Sie bearbeiten diesen Datensatz als Administrator.lowState === 3 ? 'selected' : ''}>Bereit für IT</option>form-label">Admin-Hinweise</label>
                </div>wState === 4 ? 'selected' : ''}>Abgeschlossen</option>alAdminNotes" rows="3">${record.adminNotes || ''}</textarea>
                <div class="mb-3">
                    <label for="modalAdminWorkflowState" class="form-label">Workflow-Status</label>
                    <select class="form-select" id="modalAdminWorkflowState">>"button" class="btn btn-warning" id="btnSaveAdmin">
                        <option value="0" ${record.workflowState === 0 ? 'selected' : ''}>Neu</option>ass="form-label">Admin-Hinweise</label>amation"></i> Status ändern
                        <option value="1" ${record.workflowState === 1 ? 'selected' : ''}>Warte auf Manager</option>AdminNotes" rows="3">${record.adminNotes || ''}</textarea>
                        <option value="2" ${record.workflowState === 2 ? 'selected' : ''}>Warte auf HR Prüfung</option>utton type="button" class="btn btn-danger" id="btnDeleteRecord">
                        <option value="3" ${record.workflowState === 3 ? 'selected' : ''}>Bereit für IT</option>  <div class="mb-3">          <i class="bi bi-trash"></i> Datensatz löschenon createAdminEditSection(record) {
                        <option value="4" ${record.workflowState === 4 ? 'selected' : ''}>Abgeschlossen</option> type="button" class="btn btn-warning" id="btnSaveAdmin">n> document.createElement('div');
                    </select>               <i class="bi bi-shield-exclamation"></i> Status ändern       </div>   section.className = 'mt-4';
                </div>            </button>    `;    section.innerHTML = `
                <div class="mb-3">pe="button" class="btn btn-danger" id="btnDeleteRecord">5>
                    <label for="modalAdminNotes" class="form-label">Admin-Hinweise</label>Datensatz löschenis added to the DOM
                    <textarea class="form-control" id="modalAdminNotes" rows="3">${record.adminNotes || ''}</textarea>   </button>meout(() => {   <i class="bi bi-exclamation-triangle"></i> Achtung: Sie bearbeiten diesen Datensatz als Administrator.
                </div>
                <div class="mb-3">
                    <button type="button" class="btn btn-warning" id="btnSaveAdmin">deleteButton.addEventListener('click', function() {    <label for="modalAdminWorkflowState" class="form-label">Workflow-Status</label>
                        <i class="bi bi-shield-exclamation"></i> Status änderno the DOMorkflowState">
                    </button>= 0 ? 'selected' : ''}>Neu</option>
                    <button type="button" class="btn btn-danger" id="btnDeleteRecord">ementById('btnDeleteRecord'); ''}>Warte auf Manager</option>
                        <i class="bi bi-trash"></i> Datensatz löschen
                    </button>Listener('click', function() {ocument.getElementById('btnSaveAdmin'); ${record.workflowState === 3 ? 'selected' : ''}>Bereit für IT</option>
                </div>recordId); === 4 ? 'selected' : ''}>Abgeschlossen</option>
            `;lick', function() {
            
            // Add event handlers after the section is added to the DOM
            setTimeout(() => {
                const deleteButton = document.getElementById('btnDeleteRecord');
                if (deleteButton) {
                    deleteButton.addEventListener('click', function() {
                        confirmDeleteRecord(record.recordId);
                    });
                }
                
                const saveAdminButton = document.getElementById('btnSaveAdmin');
                if (saveAdminButton) {
                    saveAdminButton.addEventListener('click', function() {
                        saveAdminChanges(record.recordId);
                    });ment('div');se vorhanden'}
                }ame = 'mt-4';ers after the section is added to the DOM
            }, 0);nnerHTML = ` {
            ${title}</h5>ection;t deleteButton = document.getElementById('btnDeleteRecord');
            return section;
        }
        
        function createReadOnlySection(title, content) {
            const section = document.createElement('div');
            section.className = 'mt-4';
            section.innerHTML = `Id: recordId };eAdminButton = document.getElementById('btnSaveAdmin');
                <h5>${title}</h5>hangeston) {
                <div class="alert alert-secondary">s(recordId) {n visible form elementsEventListener('click', function() {
                    ${content || 'Keine Hinweise vorhanden'}
                </div>tElementById('recordModalBody');exists
            `;
            return section;
        }le form elements form
        le === 'HR') {datedData = {;
        // Save record changes/ Check if HR Edit form exists       ...updatedData,
        async function saveRecordChanges(recordId) {getElementById('modalFirstName');lementById('modalFirstName').value,
            try {{cument.getElementById('modalLastName').value,itle, content) {
                const modalBody = document.getElementById('recordModalBody');
                let updatedData = { recordId: recordId };ny: document.getElementById('modalExtCompany').value,
                ata,: document.getElementById('modalDescription').value,
                // Collect data based on visible form elementsment.getElementById('modalFirstName').value,ument.getElementById('modalOffice').value,
                if (userRole === 'HR') {yId('modalLastName').value,ntById('modalPhone').value,
                    // Check if HR Edit form exists
                    const firstNameInput = document.getElementById('modalFirstName');
                    if (firstNameInput) {
                        // This is the HR edit forme').value,Manager').value,
                        updatedData = {e').value,).value,
                            ...updatedData,
                            firstName: document.getElementById('modalFirstName').value,
                            lastName: document.getElementById('modalLastName').value,
                            external: document.getElementById('modalExternal').checked,
                            externalCompany: document.getElementById('modalExtCompany').value,
                            description: document.getElementById('modalDescription').value,
                            officeRoom: document.getElementById('modalOffice').value,
                            phoneNumber: document.getElementById('modalPhone').value,
                            mobileNumber: document.getElementById('modalMobile').value, is the HR verification formle === 'HR') {
                            emailAddress: document.getElementById('modalEmail').value,  if (!hrVerifiedInput.checked) {/ Check if HR Edit form exists
                            startWorkDate: document.getElementById('modalStartDate').value, form existstte bestätigen Sie die Überprüfung');ment.getElementById('modalFirstName');
                            assignedManager: document.getElementById('modalManager').value,dInput = document.getElementById('modalHRVerified');
                            hrNotes: document.getElementById('modalHRNotes').value,
                            workflowState: 1, // PendingManagerInputfication form
                            action: 'HRSubmit'
                        };
                    }   verificationNotes: document.getElementById('modalVerificationNotes').value,   lastName: document.getElementById('modalLastName').value,
                        workflowState: 3, // ReadyForIT    external: document.getElementById('modalExternal').checked,
                    // Check if HR Verification form existsVerify'pany: document.getElementById('modalExtCompany').value,
                    const hrVerifiedInput = document.getElementById('modalHRVerified');ById('modalDescription').value,
                    if (hrVerifiedInput) {lue,
                        // This is the HR verification formcument.getElementById('modalVerificationNotes').value,) {.getElementById('modalPhone').value,
                        if (!hrVerifiedInput.checked) {
                            throw new Error('Bitte bestätigen Sie die Überprüfung');alPosition');entById('modalEmail').value,
                        }Date').value,
                        Data = {  assignedManager: document.getElementById('modalManager').value,
                        updatedData = {e if (userRole === 'Manager') {       ...updatedData,       hrNotes: document.getElementById('modalHRNotes').value,
                            ...updatedData,dingManagerInput
                            hrVerified: true,put = document.getElementById('modalPosition');ntField: document.getElementById('modalDepartment').value,'HRSubmit'
                            verificationNotes: document.getElementById('modalVerificationNotes').value,
                            workflowState: 3, // ReadyForITetElementById('modalTermination').value,
                            action: 'HRVerify'ata,t.getElementById('modalTL').checked,
                        };ionInput.value,tElementById('modalAL').checked,tion form exists
                    }artment').value,rNotes').value,rified');
                } else if (userRole === 'Manager') {).value,ecked,
                    // Manager edit form.getElementById('modalTermination').value,ment.getElementById('modalSoftwareGenesis').checked,ation form
                    const positionInput = document.getElementById('modalPosition');  tl: document.getElementById('modalTL').checked,  zugangLizenzmanager: document.getElementById('modalZugangLizenzmanager').checked, (!hrVerifiedInput.checked) {
                    if (positionInput) {       al: document.getElementById('modalAL').checked,       zugangMS365: document.getElementById('modalZugangMS365').checked,       throw new Error('Bitte bestätigen Sie die Überprüfung');
                        updatedData = {           managerNotes: document.getElementById('modalManagerNotes').value,           zugriffe: document.getElementById('modalZugriffe').value,       }
                            ...updatedData,            softwareSage: document.getElementById('modalSoftwareSage').checked,            workflowState: 2, // PendingHRVerification        
                            position: positionInput.value,ftwareGenesis: document.getElementById('modalSoftwareGenesis').checked,tion: 'ManagerSubmit'dData = {
                            departmentField: document.getElementById('modalDepartment').value,ngLizenzmanager').checked,
                            personalNumber: document.getElementById('modalPersonalNumber').value,MS365: document.getElementById('modalZugangMS365').checked,
                            ablaufdatum: document.getElementById('modalTermination').value,griffe: document.getElementById('modalZugriffe').value,rRole === 'IT') {rificationNotes: document.getElementById('modalVerificationNotes').value,
                            tl: document.getElementById('modalTL').checked,ication
                            al: document.getElementById('modalAL').checked,ntById('modalAccountCreated');
                            managerNotes: document.getElementById('modalManagerNotes').value,  }; (accountCreatedInput) {  };
                            softwareSage: document.getElementById('modalSoftwareSage').checked,'modalEquipmentReady').checked) {
                            softwareGenesis: document.getElementById('modalSoftwareGenesis').checked,lse if (userRole === 'IT') {         throw new Error('Bitte bestätigen Sie Account-Erstellung und Ausstattung');lse if (userRole === 'Manager') {
                            zugangLizenzmanager: document.getElementById('modalZugangLizenzmanager').checked,    // IT edit form        }    // Manager edit form
                            zugangMS365: document.getElementById('modalZugangMS365').checked,eatedInput = document.getElementById('modalAccountCreated');ment.getElementById('modalPosition');
                            zugriffe: document.getElementById('modalZugriffe').value,
                            workflowState: 2, // PendingHRVerificationtedInput.checked || !document.getElementById('modalEquipmentReady').checked) {ta,
                            action: 'ManagerSubmit'ung und Ausstattung');
                        };   }       equipmentReady: true,       position: positionInput.value,
                    }entById('modalDepartment').value,
                } else if (userRole === 'IT') {
                    // IT edit form           ...updatedData,           action: 'ITComplete'           ablaufdatum: document.getElementById('modalTermination').value,
                    const accountCreatedInput = document.getElementById('modalAccountCreated');            accountCreated: true,        };            tl: document.getElementById('modalTL').checked,
                    if (accountCreatedInput) {uipmentReady: true,t.getElementById('modalAL').checked,
                        if (!accountCreatedInput.checked || !document.getElementById('modalEquipmentReady').checked) {
                            throw new Error('Bitte bestätigen Sie Account-Erstellung und Ausstattung');            workflowState: 4, // Completed    // Admin changes            softwareSage: document.getElementById('modalSoftwareSage').checked,
                        }: 'ITComplete'StateInput = document.getElementById('modalAdminWorkflowState');reGenesis: document.getElementById('modalSoftwareGenesis').checked,
                        ateInput) {gangLizenzmanager: document.getElementById('modalZugangLizenzmanager').checked,
                        updatedData = {    }        updatedData = {            zugangMS365: document.getElementById('modalZugangMS365').checked,
                            ...updatedData, 'Admin') {ata,ocument.getElementById('modalZugriffe').value,
                            accountCreated: true,n
                            equipmentReady: true,kflowStateInput = document.getElementById('modalAdminWorkflowState');dminNotes: document.getElementById('modalAdminNotes').value,ction: 'ManagerSubmit'
                            itNotes: document.getElementById('modalITNotes').value,
                            workflowState: 4, // Completed
                            action: 'ITComplete'               ...updatedData,       }   } else if (userRole === 'IT') {
                        };                   workflowState: parseInt(workflowStateInput.value),       }           // IT edit form
                    }                    adminNotes: document.getElementById('modalAdminNotes').value,                    const accountCreatedInput = document.getElementById('modalAccountCreated');
                } else if (userRole === 'Admin') { 'AdminUpdate'put) {
                    // Admin changesId}`, {ecked || !document.getElementById('modalEquipmentReady').checked) {
                    const workflowStateInput = document.getElementById('modalAdminWorkflowState');   }   method: 'PUT',           throw new Error('Bitte bestätigen Sie Account-Erstellung und Ausstattung');
                    if (workflowStateInput) {
                        updatedData = {
                            ...updatedData,// Send update        'Content-Type': 'application/json'        updatedData = {
                            workflowState: parseInt(workflowStateInput.value),
                            adminNotes: document.getElementById('modalAdminNotes').value,ingify(updatedData)tCreated: true,
                            action: 'AdminUpdate'y: true,
                        };
                    }
                } (response.status === 401) {      action: 'ITComplete'
                pdatedData)
                // Send update
                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {
                    method: 'PUT',esponse.ok) {nst error = await response.json(); Admin changes
                    headers: { if (response.status === 401) { throw new Error(error.message || 'Failed to update record'); const workflowStateInput = document.getElementById('modalAdminWorkflowState');
                        'Authorization': `Bearer ${authToken}`,        showLoginForm();}    if (workflowStateInput) {
                        'Content-Type': 'application/json'rror('Session expired. Please log in again.');
                    },
                    body: JSON.stringify(updatedData)response.json();nce(document.getElementById('recordModal')).hide();e: parseInt(workflowStateInput.value),
                });
                h records       action: 'AdminUpdate'
                if (!response.ok) {
                    if (response.status === 401) {
                        showLoginForm();ootstrap.Modal.getInstance(document.getElementById('recordModal')).hide();/ Show success message
                        throw new Error('Session expired. Please log in again.');alert('Datensatz erfolgreich aktualisiert.');
                    }ords
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to update record');alert('Fehler beim Aktualisieren des Datensatzes: ' + error.message);    method: 'PUT',
                }ssage
                tz erfolgreich aktualisiert.');authToken}`,
                // Close modaltch (error) {'Content-Type': 'application/json'
                bootstrap.Modal.getInstance(document.getElementById('recordModal')).hide();dating record:', error);
                sage);
                // Refresh records
                loadRecords();
                
                // Show success messagemin specific functions          if (response.status === 401) {
                alert('Datensatz erfolgreich aktualisiert.');sync function saveAdminChanges(recordId) {       const response = await fetch(`${apiBaseUrl}/records/${recordId}/admin`, {               showLoginForm();
            } catch (error) {    try {            method: 'PUT',                throw new Error('Session expired. Please log in again.');
                console.error('Error updating record:', error);entById('modalAdminWorkflowState').value;
                alert('Fehler beim Aktualisieren des Datensatzes: ' + error.message);
            }ontent-Type': 'application/json'hrow new Error(error.message || 'Failed to update record');
        } {
        
        // Admin specific functions parseInt(workflowState),
        async function saveAdminChanges(recordId) {
            try {
                const workflowState = document.getElementById('modalAdminWorkflowState').value;
                const adminNotes = document.getElementById('modalAdminNotes').value;y: JSON.stringify({
                    workflowState: parseInt(workflowState),!response.ok) {
                const response = await fetch(`${apiBaseUrl}/records/${recordId}/admin`, {inNotes === 401) {
                    method: 'PUT',
                    headers: {in again.');
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'onse.ok) { error = await response.json();hler beim Aktualisieren des Datensatzes: ' + error.message);
                    }, record');
                    body: JSON.stringify({
                        workflowState: parseInt(workflowState),   throw new Error('Session expired. Please log in again.');
                        adminNotes: adminNotes}lose modalcific functions
                    })await response.json();tInstance(document.getElementById('recordModal')).hide();anges(recordId) {
                });
                esh recordst workflowState = document.getElementById('modalAdminWorkflowState').value;
                if (!response.ok) {inNotes').value;
                    if (response.status === 401) {
                        showLoginForm();strap.Modal.getInstance(document.getElementById('recordModal')).hide();how success messaget response = await fetch(`${apiBaseUrl}/records/${recordId}/admin`, {
                        throw new Error('Session expired. Please log in again.');siert.');
                    }
                    const error = await response.json(); updating record as admin:', error);ation': `Bearer ${authToken}`,
                    throw new Error(error.message || 'Failed to update record');
                }
                lert('Datensatz erfolgreich als Administrator aktualisiert.'); JSON.stringify({
                // Close modal catch (error) {      workflowState: parseInt(workflowState),
                bootstrap.Modal.getInstance(document.getElementById('recordModal')).hide();       console.error('Error updating record as admin:', error);sync function confirmDeleteRecord(recordId) {               adminNotes: adminNotes
                        alert('Fehler beim Aktualisieren des Datensatzes: ' + error.message);    if (confirm('Sind Sie sicher, dass Sie diesen Datensatz löschen möchten? Diese Aktion kann nicht rückgängig gemacht werden.')) {            })
                // Refresh records
                loadRecords();
                thod: 'DELETE',f (!response.ok) {
                // Show success message
                alert('Datensatz erfolgreich als Administrator aktualisiert.');icher, dass Sie diesen Datensatz löschen möchten? Diese Aktion kann nicht rückgängig gemacht werden.')) {ization': `Bearer ${authToken}`,rm();
            } catch (error) {pe': 'application/json'new Error('Session expired. Please log in again.');
                console.error('Error updating record as admin:', error);/records/${recordId}`, {
                alert('Fehler beim Aktualisieren des Datensatzes: ' + error.message);
            }  headers: {w new Error(error.message || 'Failed to update record');
        }er ${authToken}`,
                 'Content-Type': 'application/json'     if (response.status === 401) {
        async function confirmDeleteRecord(recordId) {        }            showLoginForm();// Close modal
            if (confirm('Sind Sie sicher, dass Sie diesen Datensatz löschen möchten? Diese Aktion kann nicht rückgängig gemacht werden.')) {ssion expired. Please log in again.');Instance(document.getElementById('recordModal')).hide();
                try {
                    const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {it response.json();
                        method: 'DELETE',
                        headers: {       showLoginForm();
                            'Authorization': `Bearer ${authToken}`,ired. Please log in again.');
                            'Content-Type': 'application/json'
                        }       const error = await response.json();   bootstrap.Modal.getInstance(document.getElementById('recordModal')).hide();ch (error) {
                    });        throw new Error(error.message || 'Failed to delete record');    console.error('Error updating record as admin:', error);
                    ieren des Datensatzes: ' + error.message);
                    if (!response.ok) {
                        if (response.status === 401) {    // Close modal    
                            showLoginForm();.Modal.getInstance(document.getElementById('recordModal')).hide();uccess message
                            throw new Error('Session expired. Please log in again.');
                        }    // Refresh records} catch (error) {confirm('Sind Sie sicher, dass Sie diesen Datensatz löschen möchten? Diese Aktion kann nicht rückgängig gemacht werden.')) {
                        const error = await response.json();eting record:', error);
                        throw new Error(error.message || 'Failed to delete record');rds/${recordId}`, {
                    }    // Show success message}        method: 'DELETE',
                    atensatz erfolgreich gelöscht.');
                    // Close modalr) {rer ${authToken}`,
                    bootstrap.Modal.getInstance(document.getElementById('recordModal')).hide();or);
                    );
                    // Refresh recordsrmData) {
                    loadRecords();ry {       
                           const response = await fetch(`${apiBaseUrl}/records`, {           if (!response.ok) {
                    // Show success message            method: 'POST',                if (response.status === 401) {
                    alert('Datensatz erfolgreich gelöscht.');ord: { showLoginForm();
                } catch (error) {
                    console.error('Error deleting record:', error);       'Content-Type': 'application/json'       }
                    alert('Fehler beim Löschen des Datensatzes: ' + error.message);
                },ingify(formData)Error(error.message || 'Failed to delete record');
            }
        }
        
        // Create a new record,f (response.status === 401) {ootstrap.Modal.getInstance(document.getElementById('recordModal')).hide();
        async function createNewRecord(formData) { body: JSON.stringify(formData)     showLoginForm(); 
            try {});        throw new Error('Session expired. Please log in again.');    // Refresh records
                const response = await fetch(`${apiBaseUrl}/records`, {
                    method: 'POST',
                    headers: {   if (response.status === 401) {   throw new Error(error.message || 'Failed to create record');   // Show success message
                        'Authorization': `Bearer ${authToken}`,        showLoginForm();}    alert('Datensatz erfolgreich gelöscht.');
                        'Content-Type': 'application/json'd. Please log in again.');
                    },
                    body: JSON.stringify(formData)    const error = await response.json();loadRecords();    alert('Fehler beim Löschen des Datensatzes: ' + error.message);
                });ror.message || 'Failed to create record');
                }// Clear form
                if (!response.ok) {
                    if (response.status === 401) {
                        showLoginForm();
                        throw new Error('Session expired. Please log in again.');ert('Datensatz erfolgreich erstellt.');ction createNewRecord(formData) {
                    }// Clear form{
                    const error = await response.json();mentById('hrForm').reset();wait fetch(`${apiBaseUrl}/records`, {
                    throw new Error(error.message || 'Failed to create record');
                }
                t.');ensatzes: ' + error.message);uthToken}`,
                // Refresh records
                loadRecords();
                 (error) {N.stringify(formData)
                // Clear formconsole.error('Error creating record:', error);
                document.getElementById('hrForm').reset();Datensatzes: ' + error.message);
                own(dropdownId, selectedValue = '') {
                // Show success message
                alert('Datensatz erfolgreich erstellt.');ponse = await fetch(`${apiBaseUrl}/managers`, {       showLoginForm();
                ion expired. Please log in again.');
                return true;
            } catch (error) { function loadManagersForDropdown(dropdownId, selectedValue = '') {           'Authorization': `Bearer ${authToken}`,       const error = await response.json();
                console.error('Error creating record:', error);   try {               'Content-Type': 'application/json'           throw new Error(error.message || 'Failed to create record');
                alert('Fehler beim Erstellen des Datensatzes: ' + error.message);        const response = await fetch(`${apiBaseUrl}/managers`, {            }        }
                return false;
            }
        }       'Authorization': `Bearer ${authToken}`,f (!response.ok) {oadRecords();
        on/json'd managers');
        // Helper functions
        async function loadManagersForDropdown(dropdownId, selectedValue = '') {'hrForm').reset();
            try {
                const response = await fetch(`${apiBaseUrl}/managers`, {nse.ok) {down = document.getElementById(dropdownId);ccess message
                    method: 'GET',       throw new Error('Failed to load managers');      alert('Datensatz erfolgreich erstellt.');
                    headers: {       }       if (!dropdown) return;       
                        'Authorization': `Bearer ${authToken}`,                        return true;
                        'Content-Type': 'application/json'nse.json();cept the default one
                    } document.getElementById(dropdownId);options.length > 1) {rror creating record:', error);
                });ssage);
                
                if (!response.ok) {
                    throw new Error('Failed to load managers');except the default one
                }1) {
                (1);document.createElement('option');
                const managers = await response.json();   }       option.value = manager.username; function loadManagersForDropdown(dropdownId, selectedValue = '') {
                const dropdown = document.getElementById(dropdownId);                  option.text = manager.displayName;   try {
                        // Add managers            dropdown.add(option);        const response = await fetch(`${apiBaseUrl}/managers`, {
                if (!dropdown) return; {
                 = document.createElement('option');
                // Clear existing options except the default onenager.username; if providedn': `Bearer ${authToken}`,
                while (dropdown.options.length > 1) {me;
                    dropdown.remove(1);
                }
                
                // Add managersvided managers:', error);
                managers.forEach(manager => {   if (selectedValue) {       throw new Error('Failed to load managers');
                    const option = document.createElement('option');           dropdown.value = selectedValue;       }
                    option.value = manager.username;        }        
                    option.text = manager.displayName;r) {teForInput(dateString) {agers = await response.json();
                    dropdown.add(option);
                });
                 const date = new Date(dateString);    if (!dropdown) return;
                // Set selected value if provided as YYYY-MM-DD
                if (selectedValue) {
                    dropdown.value = selectedValue; '';r formatting date:', e);ions.length > 1) {
                }{return '';    dropdown.remove(1);
            } catch (error) {e(dateString);
                console.error('Error loading managers:', error);tring().split('T')[0]; // Format as YYYY-MM-DD
            }
        }
        
        function formatDateForInput(dateString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                return date.toISOString().split('T')[0]; // Format as YYYY-MM-DD
            } catch (e) {
                console.error('Error formatting date:', e);
                return '';
            }se 3: return 'state-it';
        }case 4: return 'state-completed'; getStateName(stateValue) {tch (error) {
        '';rror loading managers:', error);
        function getStateClass(stateValue) {
            switch(stateValue) {1: return 'Warte auf Manager';
                case 0: return 'state-new';case 2: return 'Warte auf HR Prüfung';
                case 1: return 'state-manager';e) {für IT';eString) {
                case 2: return 'state-hr';
                case 3: return 'state-it';
                case 4: return 'state-completed'; case 1: return 'Warte auf Manager';onst date = new Date(dateString);
                default: return '';    case 2: return 'Warte auf HR Prüfung'; return date.toISOString().split('T')[0]; // Format as YYYY-MM-DD
            }für IT';
        }
        
        function getStateName(stateValue) {
            switch(stateValue) {
                case 0: return 'Neu'; submission
                case 1: return 'Warte auf Manager';t handlersument.getElementById('hrForm').addEventListener('submit', async function(e) {n getStateClass(stateValue) {
                case 2: return 'Warte auf HR Prüfung';ment.addEventListener('DOMContentLoaded', function() {    e.preventDefault();switch(stateValue) {
                case 3: return 'Bereit für IT';dlers
                case 4: return 'Abgeschlossen';
                default: return 'Unbekannt';
            }function(e) {
        }
        
        // Event handlers
        document.addEventListener('DOMContentLoaded', function() {const formData = {    description: document.getElementById('txtDescription').value,
            // Initialize event handlers
                 lastName: document.getElementById('txtLastName').value,     phoneNumber: document.getElementById('txtPhone').value,n getStateName(stateValue) {
            // Handle form submission        external: document.getElementById('chkExternal').checked,        mobileNumber: document.getElementById('txtMobile').value,switch(stateValue) {
            document.getElementById('hrForm').addEventListener('submit', async function(e) { document.getElementById('txtExtCompany').value,cument.getElementById('txtMail').value,;
                e.preventDefault();
                : document.getElementById('cmbOffice').value,nager: document.getElementById('cmbAssignedManager').value 'Warte auf HR Prüfung';
                // Collect form data     phoneNumber: document.getElementById('txtPhone').value, }; case 3: return 'Bereit für IT';
                const formData = {        mobileNumber: document.getElementById('txtMobile').value,        case 4: return 'Abgeschlossen';
                    firstName: document.getElementById('txtFirstName').value,ent.getElementById('txtMail').value,
                    lastName: document.getElementById('txtLastName').value,
                    external: document.getElementById('chkExternal').checked,lementById('cmbAssignedManager').value
                    externalCompany: document.getElementById('txtExtCompany').value,
                    description: document.getElementById('txtDescription').value,
                    officeRoom: document.getElementById('cmbOffice').value,tion() {ction() {
                    phoneNumber: document.getElementById('txtPhone').value,Record(formData);mentById('extCompanyGroup').style.display = this.checked ? 'block' : 'none'; handlers
                    mobileNumber: document.getElementById('txtMobile').value,
                    emailAddress: document.getElementById('txtMail').value,rm submission
                    startWorkDate: document.getElementById('dtpStartWorkDate').value,eckboxbuttonId('hrForm').addEventListener('submit', async function(e) {
                    assignedManager: document.getElementById('cmbAssignedManager').valuetListener('change', function() {ddEventListener('click', function() {
                };document.getElementById('extCompanyGroup').style.display = this.checked ? 'block' : 'none';const recordId = this.dataset.recordId;
                
                // Create record
                await createNewRecord(formData);Handle modal save button }     firstName: document.getElementById('txtFirstName').value,
            });document.getElementById('saveRecordChanges').addEventListener('click', function() {});        lastName: document.getElementById('txtLastName').value,
            Id;
            // Handle external checkbox
            document.getElementById('chkExternal').addEventListener('change', function() {cordId);lyFilter').addEventListener('click', function() {t.getElementById('txtDescription').value,
                document.getElementById('extCompanyGroup').style.display = this.checked ? 'block' : 'none';
            });
            ment = document.getElementById('departmentFilter').value;mobileNumber: document.getElementById('txtMobile').value,
            // Handle modal save buttongetElementById('fromDate').value) : null;l').value,
            document.getElementById('saveRecordChanges').addEventListener('click', function() {yFilter').addEventListener('click', function() {etElementById('toDate').value ? new Date(document.getElementById('toDate').value) : null;nt.getElementById('dtpStartWorkDate').value,
                const recordId = this.dataset.recordId;cument.getElementById('stateFilter').value;('cmbAssignedManager').value
                if (recordId) {archText').value; toDate, department);
                    saveRecordChanges(recordId);e;
                }ment.getElementById('fromDate').value) : null;
            });e ? new Date(document.getElementById('toDate').value) : null;
            ementById('btnRefresh').addEventListener('click', function() {
            // Handle filter buttonRecords(filterState, searchText, fromDate, toDate, department);Records();
            document.getElementById('applyFilter').addEventListener('click', function() {
                const filterState = document.getElementById('stateFilter').value;
                const searchText = document.getElementById('searchText').value;le refresh buttonle new record buttonument.getElementById('extCompanyGroup').style.display = this.checked ? 'block' : 'none';
                const department = document.getElementById('departmentFilter').value;ument.getElementById('btnRefresh').addEventListener('click', function() {ument.getElementById('btnNewRecord').addEventListener('click', function() {
                const fromDate = document.getElementById('fromDate').value ? new Date(document.getElementById('fromDate').value) : null;    loadRecords();    // Find the HR tab and activate it
                const toDate = document.getElementById('toDate').value ? new Date(document.getElementById('toDate').value) : null;;
                
                loadRecords(filterState, searchText, fromDate, toDate, department);
            });document.getElementById('btnNewRecord').addEventListener('click', function() {        tab.show();    if (recordId) {
            R tab and activate itordId);
            // Handle refresh button
            document.getElementById('btnRefresh').addEventListener('click', function() {
                loadRecords(); = new bootstrap.Tab(hrTab);lementById('hrForm').reset();
            }); tab.show();filter button
               }   // Set focus to first name fieldocument.getElementById('applyFilter').addEventListener('click', function() {
            // Handle new record button        document.getElementById('txtFirstName').focus();    const filterState = document.getElementById('stateFilter').value;
            document.getElementById('btnNewRecord').addEventListener('click', function() {lue;
                // Find the HR tab and activate it
                const hrTab = document.getElementById('hr-tab');    // Handle tab changes to refresh content    const fromDate = document.getElementById('fromDate').value ? new Date(document.getElementById('fromDate').value) : null;
                if (hrTab) {st name fieldument.querySelectorAll('button[data-bs-toggle="tab"]');ment.getElementById('toDate').value ? new Date(document.getElementById('toDate').value) : null;
                    const tab = new bootstrap.Tab(hrTab);tById('txtFirstName').focus();b => {
                    tab.show(); });     tab.addEventListener('shown.bs.tab', function(event) {     loadRecords(filterState, searchText, fromDate, toDate, department);
                }                const targetId = event.target.getAttribute('data-bs-target').substring(1);    });
                tent
                // Clear the form.querySelectorAll('button[data-bs-toggle="tab"]');state based on active tab
                document.getElementById('hrForm').reset();(tab => {tate = '';ById('btnRefresh').addEventListener('click', function() {
                       tab.addEventListener('shown.bs.tab', function(event) {           switch(targetId) {       loadRecords();
                // Set focus to first name field            const targetId = event.target.getAttribute('data-bs-target').substring(1);                case 'hr': filterState = 'New'; break;    });
                document.getElementById('txtFirstName').focus();nput'; break;
            });   // Determine filter state based on active tab       case 'verification': filterState = 'PendingHRVerification'; break;ndle new record button
            
            // Handle tab changes to refresh contentd) { it
            const tabElements = document.querySelectorAll('button[data-bs-toggle="tab"]');hr': filterState = 'New'; break;etElementById('hr-tab');
            tabElements.forEach(tab => {anagerInput'; break;
                tab.addEventListener('shown.bs.tab', function(event) { 'PendingHRVerification'; break;
                    const targetId = event.target.getAttribute('data-bs-target').substring(1);   case 'it': filterState = 'ReadyForIT'; break;.show();
                     }
                    // Determine filter state based on active tab    
                    let filterState = '';d recordsgout
                    switch(targetId) {
                        case 'hr': filterState = 'New'; break;); logoutLink = document.querySelector('a[href="#"][data-action="logout"]');
                        case 'manager': filterState = 'PendingManagerInput'; break;t focus to first name field
                        case 'verification': filterState = 'PendingHRVerification'; break;
                        case 'it': filterState = 'ReadyForIT'; break;
                    }getElementById('userDropdown');
                    t logoutLink = document.querySelector('a[href="#"][data-action="logout"]');    logout();andle tab changes to refresh content
                    // Load filtered records
                    loadRecords(filterState);
                });addEventListener('click', function(e) {n.bs.tab', function(event) {
            });   e.preventDefault();ad managers for dropdown   const targetId = event.target.getAttribute('data-bs-target').substring(1);
                logout();ManagersForDropdown('cmbAssignedManager');    
            // User dropdown for logout
            const userDropdown = document.getElementById('userDropdown');
            const logoutLink = document.querySelector('a[href="#"][data-action="logout"]');
            n
            if (logoutLink) {
                logoutLink.addEventListener('click', function(e) {
                    e.preventDefault();henticationoadHRRecords() {case 'it': filterState = 'ReadyForIT'; break;
                    logout();
                });
            }
            
            // Load managers for dropdownds() {
            loadManagersForDropdown('cmbAssignedManager');
            
            // Check authentication
            checkAuthentication();oadManagerRecords() {'Authorization': `Bearer ${authToken}`,opdown = document.getElementById('userDropdown');
        });
        {apiBaseUrl}/records?state=PendingManagerInput`, {
        // Tab-specific record loading functions
        async function loadHRRecords() {: {tener('click', function(e) {
            loadRecords('New');'Authorization': `Bearer ${authToken}`,ponse.ok) {eventDefault();
        }json'anager records');
        
        async function loadManagerRecords() {
            try {onse.json();
                const response = await fetch(`${apiBaseUrl}/records?state=PendingManagerInput`, {
                    method: 'GET',
                    headers: {   }   
                        'Authorization': `Bearer ${authToken}`,              if (records.length === 0) {   // Check authentication
                        'Content-Type': 'application/json'        const records = await response.json();            recordList.innerHTML = '<div class="alert alert-info">Keine Einträge gefunden</div>';    checkAuthentication();
                    }mentById('managerRecordList');
                });ecordList.innerHTML = '';
                
                if (!response.ok) { === 0) {cord => {ds() {
                    throw new Error('Failed to load manager records');.innerHTML = '<div class="alert alert-info">Keine Einträge gefunden</div>';.assignedManager === currentUser) {;
                }
                
                const records = await response.json();em.className = 'list-group-item list-group-item-action';n loadManagerRecords() {
                const recordList = document.getElementById('managerRecordList');ords.forEach(record => {     item.dataset.recordId = record.recordId;
                recordList.innerHTML = '';    if (record.assignedManager === currentUser) {        const response = await fetch(`${apiBaseUrl}/records?state=PendingManagerInput`, {
                = document.createElement('a');TML = `
                if (records.length === 0) {
                    recordList.innerHTML = '<div class="alert alert-info">Keine Einträge gefunden</div>';       item.className = 'list-group-item list-group-item-action';               <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>       'Authorization': `Bearer ${authToken}`,
                    return;        item.dataset.recordId = record.recordId;                <span class="badge bg-warning text-dark">Warte auf Manager-Input</span>        'Content-Type': 'application/json'
                }
                
                records.forEach(record => {flex w-100 justify-content-between">tum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>
                    if (record.assignedManager === currentUser) {                <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>        `;if (!response.ok) {
                        const item = document.createElement('a');="badge bg-warning text-dark">Warte auf Manager-Input</span>cords');
                        item.href = '#';
                        item.className = 'list-group-item list-group-item-action'; <p class="mb-1">${record.description || 'Keine Beschreibung'}</p> e.preventDefault();
                        item.dataset.recordId = record.recordId;           <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>           openManagerForm(record.recordId);onst records = await response.json();
                                `;        });const recordList = document.getElementById('managerRecordList');
                        item.innerHTML = `
                            <div class="d-flex w-100 justify-content-between">on(e) {
                                <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>tDefault();
                                <span class="badge bg-warning text-dark">Warte auf Manager-Input</span>
                            </div>
                            <p class="mb-1">${record.description || 'Keine Beschreibung'}</p>    ole.error('Error loading manager records:', error);
                            <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>endChild(item);en der Manager-Aufgaben: ' + error.message);
                        `;
                        
                        item.addEventListener('click', function(e) {
                            e.preventDefault();'Error loading manager records:', error);ificationRecords() {ref = '#';
                            openManagerForm(record.recordId);
                        });
                         
                        recordList.appendChild(item);  item.innerHTML = `
                    }
                });ord.firstName} ${record.lastName}</h5>
            } catch (error) {rds?state=PendingHRVerification`, {
                console.error('Error loading manager records:', error);hod: 'GET', </div>
                alert('Fehler beim Laden der Manager-Aufgaben: ' + error.message);headers: {    <p class="mb-1">${record.description || 'Keine Beschreibung'}</p>
            }${authToken}`,d.startWorkDate).toLocaleDateString('de-DE')}</small>
        }     'Content-Type': 'application/json' throw new Error('Failed to load verification records');     `;
        
        async function loadVerificationRecords() {
            try {
                const response = await fetch(`${apiBaseUrl}/records?state=PendingHRVerification`, {   if (!response.ok) {   const recordList = document.getElementById('verificationRecordList');               openManagerForm(record.recordId);
                    method: 'GET',           throw new Error('Failed to load verification records');       recordList.innerHTML = '';               });
                    headers: {        }                        
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'onst records = await response.json();   recordList.innerHTML = '<div class="alert alert-info">Keine Einträge zur Prüfung gefunden</div>';   }
                    }
                });ML = '';
                ds:', error);
                if (!response.ok) {
                    throw new Error('Failed to load verification records');ert alert-info">Keine Einträge zur Prüfung gefunden</div>';');
                }eturn;tem.href = '#';
                tem.className = 'list-group-item list-group-item-action';
                const records = await response.json();    item.dataset.recordId = record.recordId;nction loadVerificationRecords() {
                const recordList = document.getElementById('verificationRecordList');ord => {
                recordList.innerHTML = '';, {
                   item.href = '#';       <div class="d-flex w-100 justify-content-between">   method: 'GET',
                if (records.length === 0) {    item.className = 'list-group-item list-group-item-action';            <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>    headers: {
                    recordList.innerHTML = '<div class="alert alert-info">Keine Einträge zur Prüfung gefunden</div>';ordId;er">Prüfung erforderlich</span>hToken}`,
                    return;
                }rd.position || ''}, ${record.departmentField || ''}</p>
                        <div class="d-flex w-100 justify-content-between">        <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>});
                records.forEach(record => {">${record.firstName} ${record.lastName}</h5>
                    const item = document.createElement('a');
                    item.href = '#';iv>dEventListener('click', function(e) {ew Error('Failed to load verification records');
                    item.className = 'list-group-item list-group-item-action';       <p class="mb-1">${record.position || ''}, ${record.departmentField || ''}</p>       e.preventDefault();
                    item.dataset.recordId = record.recordId;        <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>        openHRVerificationForm(record.recordId);
                    
                    item.innerHTML = `
                        <div class="d-flex w-100 justify-content-between">tener('click', function(e) {dChild(item); = '';
                            <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>
                            <span class="badge bg-danger">Prüfung erforderlich</span>Id);
                        </div>});ole.error('Error loading verification records:', error);recordList.innerHTML = '<div class="alert alert-info">Keine Einträge zur Prüfung gefunden</div>';
                        <p class="mb-1">${record.position || ''}, ${record.departmentField || ''}</p>gaben: ' + error.message);
                        <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>
                    `;
                    
                    item.addEventListener('click', function(e) {'Error loading verification records:', error);ecords() { = document.createElement('a');
                        e.preventDefault();
                        openHRVerificationForm(record.recordId);
                    });m.dataset.recordId = record.recordId;
                    
                    recordList.appendChild(item);
                });fy-content-between">
            } catch (error) {l}/records?state=ReadyForIT`, {
                console.error('Error loading verification records:', error);hod: 'GET', <span class="badge bg-danger">Prüfung erforderlich</span>
                alert('Fehler beim Laden der Prüfungsaufgaben: ' + error.message);headers: {</div>
            }${authToken}`,}, ${record.departmentField || ''}</p>
        }     'Content-Type': 'application/json' throw new Error('Failed to load IT records');     <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>
        
        async function loadITRecords() {
            try {
                const response = await fetch(`${apiBaseUrl}/records?state=ReadyForIT`, {   if (!response.ok) {   const recordList = document.getElementById('itRecordList');           e.preventDefault();
                    method: 'GET',           throw new Error('Failed to load IT records');       recordList.innerHTML = '';               openHRVerificationForm(record.recordId);
                    headers: {        }                    });
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'n();lass="alert alert-info">Keine Einträge für IT-Bearbeitung gefunden</div>';
                    }onst recordList = document.getElementById('itRecordList');   return;);
                });
                rror);
                if (!response.ok) {ngth === 0) {h(record => {beim Laden der Prüfungsaufgaben: ' + error.message);
                    throw new Error('Failed to load IT records');lert-info">Keine Einträge für IT-Bearbeitung gefunden</div>';
                }
                className = 'list-group-item list-group-item-action';
                const records = await response.json();em.dataset.recordId = record.recordId;ion loadITRecords() {
                const recordList = document.getElementById('itRecordList');records.forEach(record => {    {
                recordList.innerHTML = '';cument.createElement('a');= `ait fetch(`${apiBaseUrl}/records?state=ReadyForIT`, {
                
                if (records.length === 0) {   item.className = 'list-group-item list-group-item-action';           <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>   headers: {
                    recordList.innerHTML = '<div class="alert alert-info">Keine Einträge für IT-Bearbeitung gefunden</div>';    item.dataset.recordId = record.recordId;            <span class="badge bg-success">Bereit für IT</span>        'Authorization': `Bearer ${authToken}`,
                    return;
                }    item.innerHTML = `        <p class="mb-1">${record.position || ''}, ${record.departmentField || ''}</p>    }
                ify-content-between">(record.startWorkDate).toLocaleDateString('de-DE')}</small>
                records.forEach(record => {astName}</h5>
                    const item = document.createElement('a');
                    item.href = '#';        </div>    item.addEventListener('click', function(e) {    throw new Error('Failed to load IT records');
                    item.className = 'list-group-item list-group-item-action';ition || ''}, ${record.departmentField || ''}</p>
                    item.dataset.recordId = record.recordId;eDateString('de-DE')}</small>
                        `;    });const records = await response.json();
                    item.innerHTML = `ElementById('itRecordList');
                        <div class="d-flex w-100 justify-content-between">{
                            <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>        e.preventDefault();});
                            <span class="badge bg-success">Bereit für IT</span>
                        </div>
                        <p class="mb-1">${record.position || ''}, ${record.departmentField || ''}</p>
                        <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>
                    `;
                    
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        openITChecklist(record.recordId);
                    });
                    
                    recordList.appendChild(item);
                });
            } catch (error) {
                console.error('Error loading IT records:', error);const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {    }            <span class="badge bg-success">Bereit für IT</span>
                alert('Fehler beim Laden der IT-Aufgaben: ' + error.message);,
            }
        }orization': `Bearer ${authToken}`,.ok) {l>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>
        ent-Type': 'application/json' Error('Failed to load record details');
        // Manager form handling
        async function openManagerForm(recordId) {
            try {      const record = await response.json();           e.preventDefault();
                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {       if (!response.ok) {                      openITChecklist(record.recordId);
                    method: 'GET',            throw new Error('Failed to load record details');        // Set modal title with employee name            });
                    headers: {xtContent = 
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'onst record = await response.json();;
                    }
                }); with employee nametById('managerRecordId').value = record.recordId;or loading IT records:', error);
                ementById('managerModalTitle').textContent =  IT-Aufgaben: ' + error.message);
                if (!response.ok) {record.lastName}`;
                    throw new Error('Failed to load record details');
                }t the record ID in hidden field
                ument.getElementById('managerRecordId').value = record.recordId;Pre-fill form with existing data if availableform handling
                const record = await response.json();if (record.position) document.getElementById('managerPosition').value = record.position;nction openManagerForm(recordId) {
                d) document.getElementById('managerDepartment').value = record.departmentField;
                // Set modal title with employee namePersonalNumber').value = record.personalNumber;{recordId}`, {
                document.getElementById('managerModalTitle').textContent =  (record.ablaufdatum) document.getElementById('managerTermination').value = formatDateForInput(record.ablaufdatum);   method: 'GET',
                    `Manager-Eingabe für ${record.firstName} ${record.lastName}`;// Pre-fill form with existing data if availableif (record.tl) document.getElementById('managerTL').checked = record.tl;    headers: {
                entById('managerPosition').value = record.position;d('managerAL').checked = record.al;thToken}`,
                // Set the record ID in hidden fieldif (record.departmentField) document.getElementById('managerDepartment').value = record.departmentField;if (record.softwareSage) document.getElementById('managerSoftwareSage').checked = record.softwareSage;        'Content-Type': 'application/json'
                document.getElementById('managerRecordId').value = record.recordId;etElementById('managerPersonalNumber').value = record.personalNumber;getElementById('managerSoftwareGenesis').checked = record.softwareGenesis;
                nation').value = formatDateForInput(record.ablaufdatum);gerZugangLizenzmanager').checked = record.zugangLizenzmanager;
                // Reset form= record.tl;ngMS365').checked = record.zugangMS365;
                document.getElementById('managerForm').reset();if (record.al) document.getElementById('managerAL').checked = record.al;if (record.zugriffe) document.getElementById('managerZugriffe').value = record.zugriffe;if (!response.ok) {
                tElementById('managerSoftwareSage').checked = record.softwareSage;ementById('managerEquipment').value = record.equipment;record details');
                // Pre-fill form with existing data if availables').checked = record.softwareGenesis;ecord.managerNotes;
                if (record.position) document.getElementById('managerPosition').value = record.position;if (record.zugangLizenzmanager) document.getElementById('managerZugangLizenzmanager').checked = record.zugangLizenzmanager;
                if (record.departmentField) document.getElementById('managerDepartment').value = record.departmentField;gangMS365) document.getElementById('managerZugangMS365').checked = record.zugangMS365;odal= await response.json();
                if (record.personalNumber) document.getElementById('managerPersonalNumber').value = record.personalNumber;ugriffe').value = record.zugriffe;yId('managerFormModal'));
                if (record.ablaufdatum) document.getElementById('managerTermination').value = formatDateForInput(record.ablaufdatum);pment').value = record.equipment;
                if (record.tl) document.getElementById('managerTL').checked = record.tl;if (record.managerNotes) document.getElementById('managerNotes').value = record.managerNotes;tch (error) {document.getElementById('managerModalTitle').textContent = 
                if (record.al) document.getElementById('managerAL').checked = record.al;or);rd.firstName} ${record.lastName}`;
                if (record.softwareSage) document.getElementById('managerSoftwareSage').checked = record.softwareSage;
                if (record.softwareGenesis) document.getElementById('managerSoftwareGenesis').checked = record.softwareGenesis;p.Modal(document.getElementById('managerFormModal'));
                if (record.zugangLizenzmanager) document.getElementById('managerZugangLizenzmanager').checked = record.zugangLizenzmanager;
                if (record.zugangMS365) document.getElementById('managerZugangMS365').checked = record.zugangMS365;
                if (record.zugriffe) document.getElementById('managerZugriffe').value = record.zugriffe;
                if (record.equipment) document.getElementById('managerEquipment').value = record.equipment;
                if (record.managerNotes) document.getElementById('managerNotes').value = record.managerNotes;
                
                // Show the modal
                const modal = new bootstrap.Modal(document.getElementById('managerFormModal'));fication form handling  headers: { (record.departmentField) document.getElementById('managerDepartment').value = record.departmentField;
                modal.show();nction openHRVerificationForm(recordId) {        'Authorization': `Bearer ${authToken}`,if (record.personalNumber) document.getElementById('managerPersonalNumber').value = record.personalNumber;
            } catch (error) {e = formatDateForInput(record.ablaufdatum);
                console.error('Error loading record details for manager:', error);
                alert('Fehler beim Laden der Mitarbeiterdaten: ' + error.message);ecked = record.al;
            }.softwareSage;
        }
        
        // HR verification form handling
        async function openHRVerificationForm(recordId) {
            try {
                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }et the record ID in hidden fieldh (error) {
                });// Set modal title with employee namedocument.getElementById('hrVerificationRecordId').value = record.recordId;console.error('Error loading record details for manager:', error);
                ntById('hrVerificationTitle').textContent = beiterdaten: ' + error.message);
                if (!response.ok) {
                    throw new Error('Failed to load record details');rVerified').checked = false;
                }cord ID in hidden fieldlementById('hrVerificationNotes').value = '';
                Id;
                const record = await response.json();
                   // Reset form   const employeeInfo = document.getElementById('hrVerificationEmployeeInfo');ry {
                // Set modal title with employee name       document.getElementById('hrVerified').checked = false;       employeeInfo.innerHTML = `       const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {
                document.getElementById('hrVerificationTitle').textContent =         document.getElementById('hrVerificationNotes').value = '';            <h5>Mitarbeiterdaten</h5>            method: 'GET',
                    `HR-Prüfung für ${record.firstName} ${record.lastName}`;record.firstName} ${record.lastName}</p>
                {new Date(record.startWorkDate).toLocaleDateString('de-DE')}</p>{authToken}`,
                // Set the record ID in hidden fieldonst employeeInfo = document.getElementById('hrVerificationEmployeeInfo');   <p><strong>Büro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>       'Content-Type': 'application/json'
                document.getElementById('hrVerificationRecordId').value = record.recordId;eine Mobilnummer'}</p>
                rdaten</h5>ail:</strong> ${record.emailAddress || 'Keine E-Mail-Adresse'}</p>
                // Reset form>Name:</strong> ${record.firstName} ${record.lastName}</p>>Beschreibung:</strong> ${record.description || 'Keine Beschreibung'}</p>
                document.getElementById('hrVerified').checked = false;record.startWorkDate).toLocaleDateString('de-DE')}</p>
                document.getElementById('hrVerificationNotes').value = '';iceRoom || 'Nicht zugewiesen'}</p>
                p><strong>Kontakt:</strong> ${record.phoneNumber || 'Keine Telefonnummer'}, ${record.mobileNumber || 'Keine Mobilnummer'}</p>splay manager provided information
                // Display employee information <p><strong>E-Mail:</strong> ${record.emailAddress || 'Keine E-Mail-Adresse'}</p>st managerInfo = document.getElementById('hrVerificationManagerInfo');
                const employeeInfo = document.getElementById('hrVerificationEmployeeInfo');    <p><strong>Beschreibung:</strong> ${record.description || 'Keine Beschreibung'}</p>managerInfo.innerHTML = `const record = await response.json();
                employeeInfo.innerHTML = `
                    <h5>Mitarbeiterdaten</h5>
                    <p><strong>Name:</strong> ${record.firstName} ${record.lastName}</p>/ Display manager provided information   <p><strong>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>ocument.getElementById('hrVerificationTitle').textContent = 
                    <p><strong>Startdatum:</strong> ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</p>const managerInfo = document.getElementById('hrVerificationManagerInfo');    <p><strong>Personalnummer:</strong> ${record.personalNumber || 'Nicht angegeben'}</p>    `HR-Prüfung für ${record.firstName} ${record.lastName}`;
                    <p><strong>Büro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>d.ablaufdatum ? new Date(record.ablaufdatum).toLocaleDateString('de-DE') : 'Unbefristet'}</p>
                    <p><strong>Kontakt:</strong> ${record.phoneNumber || 'Keine Telefonnummer'}, ${record.mobileNumber || 'Keine Mobilnummer'}</p>    <h5>Manager-Informationen</h5>    <p><strong>Rolle:</strong> ${record.tl ? 'Teamleiter' : ''} ${record.al ? 'Abteilungsleiter' : ''}</p>// Set the record ID in hidden field
                    <p><strong>E-Mail:</strong> ${record.emailAddress || 'Keine E-Mail-Adresse'}</p>ecord.position || 'Nicht angegeben'}</p>ecord.softwareSage ? 'Sage, ' : ''} ${record.softwareGenesis ? 'Genesis' : ''}</p>onRecordId').value = record.recordId;
                    <p><strong>Beschreibung:</strong> ${record.description || 'Keine Beschreibung'}</p>Field || 'Nicht angegeben'}</p>manager ? 'Lizenzmanager, ' : ''} ${record.zugangMS365 ? 'MS365' : ''}</p>
                `; || 'Nicht angegeben'}</p>'Keine'}</p>
                    <p><strong>Vertragslaufzeit:</strong> ${record.ablaufdatum ? new Date(record.ablaufdatum).toLocaleDateString('de-DE') : 'Unbefristet'}</p>    <p><strong>Ausstattung:</strong> ${record.equipment || 'Standard'}</p>document.getElementById('hrVerified').checked = false;
                // Display manager provided informationord.tl ? 'Teamleiter' : ''} ${record.al ? 'Abteilungsleiter' : ''}</p>ong> ${record.managerNotes || 'Keine Notizen'}</p>ionNotes').value = '';
                const managerInfo = document.getElementById('hrVerificationManagerInfo');e, ' : ''} ${record.softwareGenesis ? 'Genesis' : ''}</p>
                managerInfo.innerHTML = `    <p><strong>Zugänge:</strong> ${record.zugangLizenzmanager ? 'Lizenzmanager, ' : ''} ${record.zugangMS365 ? 'MS365' : ''}</p>// Display employee information
                    <h5>Manager-Informationen</h5>g>Weitere Zugriffe:</strong> ${record.zugriffe || 'Keine'}</p>odaleInfo = document.getElementById('hrVerificationEmployeeInfo');
                    <p><strong>Position:</strong> ${record.position || 'Nicht angegeben'}</p> 'Standard'}</p>'hrVerificationModal'));
                    <p><strong>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>rNotes || 'Keine Notizen'}</p>
                    <p><strong>Personalnummer:</strong> ${record.personalNumber || 'Nicht angegeben'}</p>
                    <p><strong>Vertragslaufzeit:</strong> ${record.ablaufdatum ? new Date(record.ablaufdatum).toLocaleDateString('de-DE') : 'Unbefristet'}</p>
                    <p><strong>Rolle:</strong> ${record.tl ? 'Teamleiter' : ''} ${record.al ? 'Abteilungsleiter' : ''}</p>// Show the modalalert('Fehler beim Laden der Prüfungsdaten: ' + error.message);    <p><strong>Büro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>
                    <p><strong>Software:</strong> ${record.softwareSage ? 'Sage, ' : ''} ${record.softwareGenesis ? 'Genesis' : ''}</p>al(document.getElementById('hrVerificationModal'));elefonnummer'}, ${record.mobileNumber || 'Keine Mobilnummer'}</p>
                    <p><strong>Zugänge:</strong> ${record.zugangLizenzmanager ? 'Lizenzmanager, ' : ''} ${record.zugangMS365 ? 'MS365' : ''}</p>
                    <p><strong>Weitere Zugriffe:</strong> ${record.zugriffe || 'Keine'}</p>hreibung'}</p>
                    <p><strong>Ausstattung:</strong> ${record.equipment || 'Standard'}</p>record details for verification:', error);
                    <p><strong>Manager-Notizen:</strong> ${record.managerNotes || 'Keine Notizen'}</p>den der Prüfungsdaten: ' + error.message);t(recordId) {
                `;
                
                // Show the modal
                const modal = new bootstrap.Modal(document.getElementById('hrVerificationModal'));
                modal.show();
            } catch (error) {plication/json'>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>
                console.error('Error loading record details for verification:', error);${apiBaseUrl}/records/${recordId}`, {alNumber || 'Nicht angegeben'}</p>
                alert('Fehler beim Laden der Prüfungsdaten: ' + error.message);
            }
        }
        
        // IT checklist handlingrong> ${record.zugriffe || 'Keine'}</p>
        async function openITChecklist(recordId) {</strong> ${record.equipment || 'Standard'}</p>
            try {t record = await response.json();  <p><strong>Manager-Notizen:</strong> ${record.managerNotes || 'Keine Notizen'}</p>
                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {if (!response.ok) {`;
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,(document.getElementById('hrVerificationModal'));
                        'Content-Type': 'application/json'const record = await response.json();modal.show();
                    }
                });ployee nametRecordId').value = record.recordId;ng record details for verification:', error);
                
                if (!response.ok) {   `IT-Checkliste für ${record.firstName} ${record.lastName}`;/ Reset form
                    throw new Error('Failed to load record details');document.getElementById('checkADAccount').checked = false;
                }n fieldkMailbox').checked = false;
                
                const record = await response.json();cument.getElementById('itNotes').value = record.itNotes || '';ction openITChecklist(recordId) {
                // Reset form{
                // Set modal title with employee nameentById('checkADAccount').checked = false;yee information await fetch(`${apiBaseUrl}/records/${recordId}`, {
                document.getElementById('itModalTitle').textContent = lbox').checked = false;ElementById('itEmployeeInfo');
                    `IT-Checkliste für ${record.firstName} ${record.lastName}`;
                ocument.getElementById('itNotes').value = record.itNotes || '';   <h5>Mitarbeiterdaten</h5>       'Authorization': `Bearer ${authToken}`,
                // Set the record ID in hidden field    <div class="row">        'Content-Type': 'application/json'
                document.getElementById('itRecordId').value = record.recordId;mationd-6">
                
                // Reset formmployeeInfo.innerHTML = `           <p><strong>Position:</strong> ${record.position || 'Nicht angegeben'}</p>
                document.getElementById('checkADAccount').checked = false;    <h5>Mitarbeiterdaten</h5>            <p><strong>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>if (!response.ok) {
                document.getElementById('checkMailbox').checked = false;w">rong>Startdatum:</strong> ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</p>r('Failed to load record details');
                document.getElementById('checkPermissions').checked = false;-md-6">
                document.getElementById('itNotes').value = record.itNotes || '';
                           <p><strong>Position:</strong> ${record.position || 'Nicht angegeben'}</p>           <p><strong>Büro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>onst record = await response.json();
                // Display employee information            <p><strong>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>            <p><strong>E-Mail:</strong> ${record.emailAddress || 'Keine E-Mail-Adresse'}</p>
                const employeeInfo = document.getElementById('itEmployeeInfo');tdatum:</strong> ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</p>fon:</strong> ${record.phoneNumber || 'Keine Telefonnummer'}</p>loyee name
                employeeInfo.innerHTML = `lnummer:</strong> ${record.personalNumber || 'Nicht angegeben'}</p>d('itModalTitle').textContent = 
                    <h5>Mitarbeiterdaten</h5>
                    <div class="row">           <p><strong>Büro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>   </div>
                        <div class="col-md-6">            <p><strong>E-Mail:</strong> ${record.emailAddress || 'Keine E-Mail-Adresse'}</p>`;// Set the record ID in hidden field
                            <p><strong>Name:</strong> ${record.firstName} ${record.lastName}</p>trong>Telefon:</strong> ${record.phoneNumber || 'Keine Telefonnummer'}</p>d').value = record.recordId;
                            <p><strong>Position:</strong> ${record.position || 'Nicht angegeben'}</p>ht angegeben'}</p>
                            <p><strong>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>>Checklist = document.getElementById('itDynamicChecklist');
                            <p><strong>Startdatum:</strong> ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</p>.innerHTML = '';lementById('checkADAccount').checked = false;
                        </div>
                        <div class="col-md-6">
                            <p><strong>Büro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>   // Build dynamic checklist based on manager selections   if (record.softwareSage) {   document.getElementById('itNotes').value = record.itNotes || '';
                            <p><strong>E-Mail:</strong> ${record.emailAddress || 'Keine E-Mail-Adresse'}</p>       const dynamicChecklist = document.getElementById('itDynamicChecklist');           addChecklistItem(dynamicChecklist, 'checkSoftwareSage', 'Sage installieren');       
                            <p><strong>Telefon:</strong> ${record.phoneNumber || 'Keine Telefonnummer'}</p>        dynamicChecklist.innerHTML = '';        }        // Display employee information
                            <p><strong>Personalnummer:</strong> ${record.personalNumber || 'Nicht angegeben'}</p>
                        </div>
                    </div>t, 'checkSoftwareGenesis', 'Genesis installieren');
                `;        addChecklistItem(dynamicChecklist, 'checkSoftwareSage', 'Sage installieren');    }        <div class="row">
                
                // Build dynamic checklist based on manager selections} ${record.lastName}</p>
                const dynamicChecklist = document.getElementById('itDynamicChecklist');
                dynamicChecklist.innerHTML = '';Genesis installieren');gang zum Lizenzmanager einrichten');eld || 'Nicht angegeben'}</p>
                strong>Startdatum:</strong> ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</p>
                // Software checks              </div>
                if (record.softwareSage) {    // Access checks    if (record.zugangMS365) {            <div class="col-md-6">
                    addChecklistItem(dynamicChecklist, 'checkSoftwareSage', 'Sage installieren');anager) {amicChecklist, 'checkMS365', 'MS365 Lizenz zuweisen');üro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>
                }           addChecklistItem(dynamicChecklist, 'checkLizenzmanager', 'Zugang zum Lizenzmanager einrichten');       }                   <p><strong>E-Mail:</strong> ${record.emailAddress || 'Keine E-Mail-Adresse'}</p>
                        }                            <p><strong>Telefon:</strong> ${record.phoneNumber || 'Keine Telefonnummer'}</p>
                if (record.softwareGenesis) {/strong> ${record.personalNumber || 'Nicht angegeben'}</p>
                    addChecklistItem(dynamicChecklist, 'checkSoftwareGenesis', 'Genesis installieren');
                }zenz zuweisen');cord.equipment} vorbereiten`);
                    }    }    `;
                // Access checks
                if (record.zugangLizenzmanager) {ss checkshecklist based on manager selections
                    addChecklistItem(dynamicChecklist, 'checkLizenzmanager', 'Zugang zum Lizenzmanager einrichten'); document.getElementById('itDynamicChecklist');
                }Checklist, 'checkEquipment', `${record.equipment} vorbereiten`);Checklist, 'checkZugriffe', 'Zusätzliche Zugriffe einrichten'); '';
                
                if (record.zugangMS365) {
                    addChecklistItem(dynamicChecklist, 'checkMS365', 'MS365 Lizenz zuweisen');
                }
                ', 'Zusätzliche Zugriffe einrichten');
                // Equipment check
                if (record.equipment) {
                    addChecklistItem(dynamicChecklist, 'checkEquipment', `${record.equipment} vorbereiten`);
                }
                
                // Additional access checks
                if (record.zugriffe) {rror);
                    addChecklistItem(dynamicChecklist, 'checkZugriffe', 'Zusätzliche Zugriffe einrichten');richten');
                }ame = 'list-group-item';
                
                // Show the modal
                const modal = new bootstrap.Modal(document.getElementById('itChecklistModal'));container, id, label) {heck">em(dynamicChecklist, 'checkMS365', 'MS365 Lizenz zuweisen');
                modal.show();ent.createElement('div');ss="form-check-input" type="checkbox" id="${id}">
            } catch (error) {>
                console.error('Error loading record details for IT checklist:', error);
                alert('Fehler beim Laden der Checkliste: ' + error.message);HTML = `ipment) {
            }ereiten`);
        } <input class="form-check-input" type="checkbox" id="${id}">er.appendChild(item);
            <label class="form-check-label" for="${id}">${label}</label>
        function addChecklistItem(container, id, label) {
            const item = document.createElement('div');
            item.className = 'list-group-item'; submitManagerForm() {   addChecklistItem(dynamicChecklist, 'checkZugriffe', 'Zusätzliche Zugriffe einrichten');
            ainer.appendChild(item);t recordId = document.getElementById('managerRecordId').value;}
            item.innerHTML = `
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="${id}">submission handlersconst formData = {const modal = new bootstrap.Modal(document.getElementById('itChecklistModal'));
                    <label class="form-check-label" for="${id}">${label}</label>erForm() {rdId,
                </div>.getElementById('managerRecordId').value;ubmit',
            `;position: document.getElementById('managerPosition').value,console.error('Error loading record details for IT checklist:', error);
            'managerDepartment').value,n der Checkliste: ' + error.message);
            container.appendChild(item);
        } recordId,um: document.getElementById('managerTermination').value,
        
        // Form submission handlerslue,
        async function submitManagerForm() {       departmentField: document.getElementById('managerDepartment').value,       softwareSage: document.getElementById('managerSoftwareSage').checked,onst item = document.createElement('div');
            const recordId = document.getElementById('managerRecordId').value;           personalNumber: document.getElementById('managerPersonalNumber').value,           softwareGenesis: document.getElementById('managerSoftwareGenesis').checked,   item.className = 'list-group-item';
                        ablaufdatum: document.getElementById('managerTermination').value,            zugangLizenzmanager: document.getElementById('managerZugangLizenzmanager').checked,    
            try {('managerTL').checked,ementById('managerZugangMS365').checked,
                const formData = {
                    recordId: recordId,        softwareSage: document.getElementById('managerSoftwareSage').checked,        equipment: document.getElementById('managerEquipment').value,        <input class="form-check-input" type="checkbox" id="${id}">
                    action: 'ManagerSubmit',agerSoftwareGenesis').checked,rNotes').value{label}</label>
                    position: document.getElementById('managerPosition').value,ngLizenzmanager').checked,
                    departmentField: document.getElementById('managerDepartment').value,angMS365: document.getElementById('managerZugangMS365').checked,
                    personalNumber: document.getElementById('managerPersonalNumber').value,       zugriffe: document.getElementById('managerZugriffe').value,   const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {
                    ablaufdatum: document.getElementById('managerTermination').value,        equipment: document.getElementById('managerEquipment').value,        method: 'PUT',container.appendChild(item);
                    tl: document.getElementById('managerTL').checked,   managerNotes: document.getElementById('managerNotes').value   headers: {
                    al: document.getElementById('managerAL').checked,{authToken}`,
                    softwareSage: document.getElementById('managerSoftwareSage').checked,
                    softwareGenesis: document.getElementById('managerSoftwareGenesis').checked,fetch(`${apiBaseUrl}/records/${recordId}`, {
                    zugangLizenzmanager: document.getElementById('managerZugangLizenzmanager').checked,(formData).getElementById('managerRecordId').value;
                    zugangMS365: document.getElementById('managerZugangMS365').checked,
                    zugriffe: document.getElementById('managerZugriffe').value,{authToken}`,
                    equipment: document.getElementById('managerEquipment').value,      'Content-Type': 'application/json' (!response.ok) {nst formData = {
                    managerNotes: document.getElementById('managerNotes').value    },    throw new Error('Failed to update record');    recordId: recordId,
                };
                ion').value,
                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {t.getElementById('managerDepartment').value,
                    method: 'PUT',de();nagerPersonalNumber').value,
                    headers: {rd');
                        'Authorization': `Bearer ${authToken}`,records: document.getElementById('managerTL').checked,
                        'Content-Type': 'application/json'
                    },Close modalftwareSage: document.getElementById('managerSoftwareSage').checked,
                    body: JSON.stringify(formData)bootstrap.Modal.getInstance(document.getElementById('managerFormModal')).hide();// Show success message    softwareGenesis: document.getElementById('managerSoftwareGenesis').checked,
                });ittelt. HR wurde benachrichtigt.');ager: document.getElementById('managerZugangLizenzmanager').checked,
                
                if (!response.ok) {oadManagerRecords();onsole.error('Error submitting manager form:', error);   zugriffe: document.getElementById('managerZugriffe').value,
                    throw new Error('Failed to update record');alert('Fehler beim Speichern der Daten: ' + error.message);    equipment: document.getElementById('managerEquipment').value,
                }s messagelementById('managerNotes').value
                
                // Close modaltch (error) {
                bootstrap.Modal.getInstance(document.getElementById('managerFormModal')).hide();or submitting manager form:', error);ification() {wait fetch(`${apiBaseUrl}/records/${recordId}`, {
                rn der Daten: ' + error.message);lementById('hrVerificationRecordId').value;
                // Refresh recordsders: {
                loadManagerRecords();earer ${authToken}`,
                
                // Show success messageHRVerification() {
                alert('Informationen erfolgreich übermittelt. HR wurde benachrichtigt.');Id').value;
            } catch (error) {
                console.error('Error submitting manager form:', error);f (!document.getElementById('hrVerified').checked) {ry {   
                alert('Fehler beim Speichern der Daten: ' + error.message);       alert('Bitte bestätigen Sie die Überprüfung aller Angaben.');       const formData = {       if (!response.ok) {
            }        return;            recordId: recordId,            throw new Error('Failed to update record');
        }
        
        async function submitHRVerification() {try {        verificationNotes: document.getElementById('hrVerificationNotes').value,    // Close modal
            const recordId = document.getElementById('hrVerificationRecordId').value;();
            
            if (!document.getElementById('hrVerified').checked) {
                alert('Bitte bestätigen Sie die Überprüfung aller Angaben.');erified: true,esponse = await fetch(`${apiBaseUrl}/records/${recordId}`, {agerRecords();
                return;       verificationNotes: document.getElementById('hrVerificationNotes').value,       method: 'PUT',   
            }        workflowState: 3 // ReadyForIT        headers: {    // Show success message
            ;       'Authorization': `Bearer ${authToken}`,lert('Informationen erfolgreich übermittelt. HR wurde benachrichtigt.');
            try {/json'
                const formData = {fetch(`${apiBaseUrl}/records/${recordId}`, {form:', error);
                    recordId: recordId,a)ern der Daten: ' + error.message);
                    action: 'HRVerify',
                    hrVerified: true,`Bearer ${authToken}`,
                    verificationNotes: document.getElementById('hrVerificationNotes').value,
                    workflowState: 3 // ReadyForIT
                };  body: JSON.stringify(formData)ecordId = document.getElementById('hrVerificationRecordId').value;
                });
                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {
                    method: 'PUT',{tInstance(document.getElementById('hrVerificationModal')).hide();tigen Sie die Überprüfung aller Angaben.');
                    headers: {Error('Failed to update record');
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },se modal
                    body: JSON.stringify(formData)nt.getElementById('hrVerificationModal')).hide();
                });'Überprüfung abgeschlossen. Die IT-Abteilung wurde informiert.'); recordId: recordId,
                // Refresh recordstch (error) {    action: 'HRVerify',
                if (!response.ok) {ords();r submitting HR verification:', error);e,
                    throw new Error('Failed to update record');
                }/ Show success messageorkflowState: 3 // ReadyForIT
                alert('Überprüfung abgeschlossen. Die IT-Abteilung wurde informiert.');
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('hrVerificationModal')).hide();
                alert('Fehler bei der Bestätigung: ' + error.message);t recordId = document.getElementById('itRecordId').value;    method: 'PUT',
                // Refresh records
                loadVerificationRecords();ckedzation': `Bearer ${authToken}`,
                t.getElementById('checkADAccount').checked || !document.getElementById('checkMailbox').checked) {        'Content-Type': 'application/json'
                // Show success messageon() {e sicher, dass AD-Account und Mailbox eingerichtet wurden.');
                alert('Überprüfung abgeschlossen. Die IT-Abteilung wurde informiert.');d('itRecordId').value;
            } catch (error) {
                console.error('Error submitting HR verification:', error);
                alert('Fehler bei der Bestätigung: ' + error.message);d || !document.getElementById('checkMailbox').checked) {
            }   alert('Bitte stellen Sie sicher, dass AD-Account und Mailbox eingerichtet wurden.');   const formData = {       throw new Error('Failed to update record');
        }       return;           recordId: recordId,       }
            }            action: 'ITComplete',        
        async function submitITCompletion() {ated: true,ose modal
            const recordId = document.getElementById('itRecordId').value;nt.getElementById('hrVerificationModal')).hide();
            onst formData = {   itNotes: document.getElementById('itNotes').value,
            // Check if all required checkboxes are checked
            if (!document.getElementById('checkADAccount').checked || !document.getElementById('checkMailbox').checked) {plete',
                alert('Bitte stellen Sie sicher, dass AD-Account und Mailbox eingerichtet wurden.');ated: true,
                return;
            }tes').value,t.');
            orkflowState: 4 // Completedeaders: {error) {
            try {    'Authorization': `Bearer ${authToken}`,sole.error('Error submitting HR verification:', error);
                const formData = {        'Content-Type': 'application/json'alert('Fehler bei der Bestätigung: ' + error.message);
                    recordId: recordId,ait fetch(`${apiBaseUrl}/records/${recordId}`, {
                    action: 'ITComplete',
                    accountCreated: true,   headers: {);
                    equipmentReady: true,        'Authorization': `Bearer ${authToken}`,nction submitITCompletion() {
                    itNotes: document.getElementById('itNotes').value,n/json'value;
                    workflowState: 4 // Completed
                };
                ntById('checkMailbox').checked) {
                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {sicher, dass AD-Account und Mailbox eingerichtet wurden.');
                    method: 'PUT',ChecklistModal')).hide();
                    headers: {o update record');
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },l
                    body: JSON.stringify(formData)ntById('itChecklistModal')).hide();
                });
                   // Refresh records catch (error) {       accountCreated: true,
                if (!response.ok) {       loadITRecords();       console.error('Error submitting IT completion:', error);           equipmentReady: true,
                    throw new Error('Failed to update record');                alert('Fehler beim Speichern: ' + error.message);            itNotes: document.getElementById('itNotes').value,
                }
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('itChecklistModal')).hide();    console.error('Error submitting IT completion:', error);SV Export    const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {
                eichern: ' + error.message);
                // Refresh records
                loadITRecords();xport`, {ion': `Bearer ${authToken}`,
                od: 'GET',        'Content-Type': 'application/json'
                // Show success message
                alert('Onboarding abgeschlossen!'); {tion': `Bearer ${authToken}`,ingify(formData)
            } catch (error) {
                console.error('Error submitting IT completion:', error);
                alert('Fehler beim Speichern: ' + error.message);
            }
        }
        
        // CSV Export
        async function exportCSV() {
            try {
                const response = await fetch(`${apiBaseUrl}/export`, {
                    method: 'GET',
                    headers: {tyle.display = 'none';
                        'Authorization': `Bearer ${authToken}`,a.href = url;// Show success message
                        'Content-Type': 'application/json'it response.blob();boarding_export.csv';g abgeschlossen!');
                    }ectURL(blob);
                }); const a = document.createElement('a'); a.click(); console.error('Error submitting IT completion:', error);
                    a.style.display = 'none';    window.URL.revokeObjectURL(url);    alert('Fehler beim Speichern: ' + error.message);
                if (!response.ok) {
                    throw new Error('Failed to export data');
                }
                 a.click();port
                const blob = await response.blob();    window.URL.revokeObjectURL(url);unction exportCSV() {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';ssage);unction() {
                a.href = url;
                a.download = 'onboarding_export.csv';
                document.body.appendChild(a);handlers with specific data loading       'Content-Type': 'application/json'
                a.click();t handlers for tab switchingst tabElements = document.querySelectorAll('button[data-bs-toggle="tab"]');     }
                window.URL.revokeObjectURL(url);ment.addEventListener('DOMContentLoaded', function() {tabElements.forEach(tab => {    });
            } catch (error) {('shown.bs.tab', function(event) {
                console.error('Error exporting CSV:', error);
                alert('Fehler beim Export: ' + error.message);
            }e="tab"]');
        }
        
        // Event handlers for tab switching
        document.addEventListener('DOMContentLoaded', function() {            case 'manager':const a = document.createElement('a');
            // Initialize event handlers
                     case 'hr':             break; a.href = url;
            // Handle form submission                loadHRRecords();            case 'verification':    a.download = 'onboarding_export.csv';
            document.getElementById('hrForm').addEventListener('submit', async function(e) {cationRecords();Child(a);
                e.preventDefault();
                adManagerRecords();it':okeObjectURL(url);
                // Collect form data             break;             loadITRecords();atch (error) {
                const formData = {            case 'verification':                break;    console.error('Error exporting CSV:', error);
                    firstName: document.getElementById('txtFirstName').value,ationRecords();age);
                    lastName: document.getElementById('txtLastName').value,
                    external: document.getElementById('chkExternal').checked,
                    externalCompany: document.getElementById('txtExtCompany').value,
                    description: document.getElementById('txtDescription').value,break;submissionr tab switching
                    officeRoom: document.getElementById('cmbOffice').value,erForm);ction() {
                    phoneNumber: document.getElementById('txtPhone').value,
                    mobileNumber: document.getElementById('txtMobile').value,erification submission
                    emailAddress: document.getElementById('txtMail').value,.getElementById('btnHRVerify').addEventListener('click', submitHRVerification);andle form submission
                    startWorkDate: document.getElementById('dtpStartWorkDate').value,ssionListener('submit', async function(e) {
                    assignedManager: document.getElementById('cmbAssignedManager').valuedEventListener('click', submitManagerForm);
                };.getElementById('btnITComplete').addEventListener('click', submitITCompletion);
                
                // Create recordner('click', submitHRVerification);
                await createNewRecord(formData);nt.getElementById('btnExportCSV').addEventListener('click', exportCSV);     firstName: document.getElementById('txtFirstName').value,
            });// IT checklist submission        lastName: document.getElementById('txtLastName').value,
            .addEventListener('click', submitITCompletion);hecked,
            // Handle external checkbox
            document.getElementById('chkExternal').addEventListener('change', function() {
                document.getElementById('extCompanyGroup').style.display = this.checked ? 'block' : 'none';click', exportCSV);
            });
            isting code...
            // Handle modal save button
            document.getElementById('saveRecordChanges').addEventListener('click', function() {
                const recordId = this.dataset.recordId;
                if (recordId) {
                    saveRecordChanges(recordId);
                }
            });
            f (response.status === 401) {
            // Handle filter button    showLoginForm();
            document.getElementById('applyFilter').addEventListener('click', function() {sion expired. Please log in again.');
                const filterState = document.getElementById('stateFilter').value;
                const searchText = document.getElementById('searchText').value; throw new Error('Failed to load record details');
                const department = document.getElementById('departmentFilter').value; }
                const fromDate = document.getElementById('fromDate').value ? new Date(document.getElementById('fromDate').value) : null;    
                const toDate = document.getElementById('toDate').value ? new Date(document.getElementById('toDate').value) : null;sponse.json();
                
                loadRecords(filterState, searchText, fromDate, toDate, department);
            });    updateWorkflowDisplay(record.workflowState);
            
            // Handle refresh button
            document.getElementById('btnRefresh').addEventListener('click', function() {('recordModalTitle').textContent = 
                loadRecords();.firstName} ${record.lastName}`;
            });
               // Configure modal content based on workflow state and user role
            // Handle new record button    const modalBody = document.getElementById('recordModalBody');
            document.getElementById('btnNewRecord').addEventListener('click', function() {
                // Find the HR tab and activate it
                const hrTab = document.getElementById('hr-tab');    // Add common details section
                if (hrTab) {n = document.createElement('div');
                    const tab = new bootstrap.Tab(hrTab);erHTML = `
                    tab.show();         <div class="card mb-3">
                }                <div class="card-header bg-secondary text-white">
                on-lines-fill"></i> Grunddaten
                // Clear the form
                document.getElementById('hrForm').reset();ass="card-body">
                                   <div class="row mb-3">
                // Set focus to first name field                        <div class="col-md-6">
                document.getElementById('txtFirstName').focus();g>Name:</strong> ${record.firstName} ${record.lastName}</p>
            });                   <p><strong>Position:</strong> ${record.position || 'Nicht angegeben'}</p>
            icht angegeben'}</p>
            // Handle tab changes to refresh content  <p><strong>Startdatum:</strong> ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</p>
            const tabElements = document.querySelectorAll('button[data-bs-toggle="tab"]');  </div>
            tabElements.forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(event) {ng> ${record.officeRoom || 'Nicht zugewiesen'}</p>
                    const targetId = event.target.getAttribute('data-bs-target').substring(1);               <p><strong>Telefon:</strong> ${record.phoneNumber || 'Nicht angegeben'}</p>
                                     <p><strong>Mobil:</strong> ${record.mobileNumber || 'Nicht angegeben'}</p>
                    // Determine filter state based on active tab                    <p><strong>E-Mail:</strong> ${record.emailAddress || 'Nicht angegeben'}</p>
                    let filterState = '';iv>
                    switch(targetId) {
                        case 'hr': filterState = 'New'; break;           <div class="mb-3">
                        case 'manager': filterState = 'PendingManagerInput'; break;                <p><strong>Beschreibung:</strong> ${record.description || 'Keine Beschreibung'}</p>
                        case 'verification': filterState = 'PendingHRVerification'; break;
                        case 'it': filterState = 'ReadyForIT'; break;
                    }
                    `;
                    // Load filtered recordslsSection);
                    loadRecords(filterState);
                });flow state specific section
            });onst workflowSection = document.createElement('div');
            workflowSection.className = 'card mb-3';
            // User dropdown for logout
            const userDropdown = document.getElementById('userDropdown');
            const logoutLink = document.querySelector('a[href="#"][data-action="logout"]');
            innerHTML = `
            if (logoutLink) {
                logoutLink.addEventListener('click', function(e) {</i> Nächster Schritt: HR Eingabe
                    e.preventDefault();    </div>
                    logout();rd-body">
                });n der HR-Abteilung bearbeitet werden.</p>
            }
            
            // Load managers for dropdown  <li>Vervollständigen der persönlichen Daten</li>
            loadManagersForDropdown('cmbAssignedManager');
            
            // Check authentication      </ul>
            checkAuthentication();    </div>
        });
        
        // Tab-specific record loading functions
        async function loadHRRecords() {kflowSection.innerHTML = `
            loadRecords('New');    <div class="card-header bg-warning text-dark">
        }n-badge"></i> Nächster Schritt: Manager-Eingabe
               </div>
        async function loadManagerRecords() {         <div class="card-body">
            try {   <p>Dieser Eintrag wurde an den Manager <strong>${record.assignedManager || 'Nicht zugewiesen'}</strong> weitergeleitet.</p>
                const response = await fetch(`${apiBaseUrl}/records?state=PendingManagerInput`, {nen bereitstellen:</p>
                    method: 'GET',
                    headers: {                       <li>Position und Abteilung</li>
                        'Authorization': `Bearer ${authToken}`,                           <li>Benötigte Software</li>
                        'Content-Type': 'application/json'                            <li>Erforderliche Zugänge</li>
                    }g und Arbeitsplatz</li>
                });               </ul>
                
                if (!response.ok) {
                    throw new Error('Failed to load manager records');
                }
                
                const records = await response.json();       <div class="card-header bg-danger text-white">
                const recordList = document.getElementById('managerRecordList');             <i class="bi bi-shield-check"></i> Nächster Schritt: HR-Überprüfung
                recordList.innerHTML = '';            </div>
                ass="card-body">
                if (records.length === 0) {n und müssen nun von der HR-Abteilung überprüft werden.</p>
                    recordList.innerHTML = '<div class="alert alert-info">Keine Einträge gefunden</div>';               <p>Die HR-Abteilung wird folgende Aufgaben durchführen:</p>
                    return;                <ul>
                } Angaben</li>
                ationen vorliegen</li>
                records.forEach(record => {eigabe für die IT-Abteilung</li>
                    if (record.assignedManager === currentUser) {                </ul>
                        const item = document.createElement('a');
                        item.href = '#';
                        item.className = 'list-group-item list-group-item-action';ak;
                        item.dataset.recordId = record.recordId;   case 3: // ReadyForIT
                                workflowSection.innerHTML = `
                        item.innerHTML = `d-header bg-success text-white">
                            <div class="d-flex w-100 justify-content-between">Nächster Schritt: IT-Einrichtung
                                <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>
                                <span class="badge bg-warning text-dark">Warte auf Manager-Input</span>
                            </div>geschlossen. Der Vorgang wurde an die IT-Abteilung weitergeleitet.</p>
                            <p class="mb-1">${record.description || 'Keine Beschreibung'}</p>            <p>Die IT-Abteilung wird folgende Aufgaben durchführen:</p>
                            <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>
                        `;                                                item.addEventListener('click', function(e) {                            e.preventDefault();                            openManagerForm(record.recordId);                        });                                                recordList.appendChild(item);                    }                });            } catch (error) {                console.error('Error loading manager records:', error);                alert('Fehler beim Laden der Manager-Aufgaben: ' + error.message);            }        }                async function loadVerificationRecords() {            try {                const response = await fetch(`${apiBaseUrl}/records?state=PendingHRVerification`, {                    method: 'GET',                    headers: {                        'Authorization': `Bearer ${authToken}`,                        'Content-Type': 'application/json'                    }                });                                if (!response.ok) {                    throw new Error('Failed to load verification records');                }                                const records = await response.json();                const recordList = document.getElementById('verificationRecordList');                recordList.innerHTML = '';                                if (records.length === 0) {                    recordList.innerHTML = '<div class="alert alert-info">Keine Einträge zur Prüfung gefunden</div>';                    return;                }                                records.forEach(record => {                    const item = document.createElement('a');                    item.href = '#';                    item.className = 'list-group-item list-group-item-action';                    item.dataset.recordId = record.recordId;                                        item.innerHTML = `                        <div class="d-flex w-100 justify-content-between">                            <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>                            <span class="badge bg-danger">Prüfung erforderlich</span>                        </div>                        <p class="mb-1">${record.position || ''}, ${record.departmentField || ''}</p>                        <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>                    `;                                        item.addEventListener('click', function(e) {                        e.preventDefault();                        openHRVerificationForm(record.recordId);                    });                                        recordList.appendChild(item);                });            } catch (error) {                console.error('Error loading verification records:', error);                alert('Fehler beim Laden der Prüfungsaufgaben: ' + error.message);            }        }                async function loadITRecords() {            try {                const response = await fetch(`${apiBaseUrl}/records?state=ReadyForIT`, {                    method: 'GET',                    headers: {                        'Authorization': `Bearer ${authToken}`,                        'Content-Type': 'application/json'                    }                });                                if (!response.ok) {                    throw new Error('Failed to load IT records');                }                                const records = await response.json();                const recordList = document.getElementById('itRecordList');                recordList.innerHTML = '';                                if (records.length === 0) {                    recordList.innerHTML = '<div class="alert alert-info">Keine Einträge für IT-Bearbeitung gefunden</div>';                    return;                }                                records.forEach(record => {                    const item = document.createElement('a');                    item.href = '#';                    item.className = 'list-group-item list-group-item-action';                    item.dataset.recordId = record.recordId;                                        item.innerHTML = `                        <div class="d-flex w-100 justify-content-between">                            <h5 class="mb-1">${record.firstName} ${record.lastName}</h5>                            <span class="badge bg-success">Bereit für IT</span>                        </div>                        <p class="mb-1">${record.position || ''}, ${record.departmentField || ''}</p>                        <small>Startdatum: ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</small>                    `;                                        item.addEventListener('click', function(e) {                        e.preventDefault();                        openITChecklist(record.recordId);                    });                                        recordList.appendChild(item);                });            } catch (error) {                console.error('Error loading IT records:', error);                alert('Fehler beim Laden der IT-Aufgaben: ' + error.message);            }        }                // Manager form handling        async function openManagerForm(recordId) {            try {                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {                    method: 'GET',                    headers: {                        'Authorization': `Bearer ${authToken}`,                        'Content-Type': 'application/json'                    }                });                                if (!response.ok) {                    throw new Error('Failed to load record details');                }                                const record = await response.json();                                // Set modal title with employee name                document.getElementById('managerModalTitle').textContent =                     `Manager-Eingabe für ${record.firstName} ${record.lastName}`;                                // Set the record ID in hidden field                document.getElementById('managerRecordId').value = record.recordId;                                // Reset form                document.getElementById('managerForm').reset();                                // Pre-fill form with existing data if available                if (record.position) document.getElementById('managerPosition').value = record.position;                if (record.departmentField) document.getElementById('managerDepartment').value = record.departmentField;                if (record.personalNumber) document.getElementById('managerPersonalNumber').value = record.personalNumber;                if (record.ablaufdatum) document.getElementById('managerTermination').value = formatDateForInput(record.ablaufdatum);                if (record.tl) document.getElementById('managerTL').checked = record.tl;                if (record.al) document.getElementById('managerAL').checked = record.al;                if (record.softwareSage) document.getElementById('managerSoftwareSage').checked = record.softwareSage;                if (record.softwareGenesis) document.getElementById('managerSoftwareGenesis').checked = record.softwareGenesis;                if (record.zugangLizenzmanager) document.getElementById('managerZugangLizenzmanager').checked = record.zugangLizenzmanager;                if (record.zugangMS365) document.getElementById('managerZugangMS365').checked = record.zugangMS365;                if (record.zugriffe) document.getElementById('managerZugriffe').value = record.zugriffe;                if (record.equipment) document.getElementById('managerEquipment').value = record.equipment;                if (record.managerNotes) document.getElementById('managerNotes').value = record.managerNotes;                                // Show the modal                const modal = new bootstrap.Modal(document.getElementById('managerFormModal'));                modal.show();            } catch (error) {                console.error('Error loading record details for manager:', error);                alert('Fehler beim Laden der Mitarbeiterdaten: ' + error.message);            }        }                // HR verification form handling        async function openHRVerificationForm(recordId) {            try {                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {                    method: 'GET',                    headers: {                        'Authorization': `Bearer ${authToken}`,                        'Content-Type': 'application/json'                    }                });                                if (!response.ok) {                    throw new Error('Failed to load record details');                }                                const record = await response.json();                                // Set modal title with employee name                document.getElementById('hrVerificationTitle').textContent =                     `HR-Prüfung für ${record.firstName} ${record.lastName}`;                                // Set the record ID in hidden field                document.getElementById('hrVerificationRecordId').value = record.recordId;                                // Reset form                document.getElementById('hrVerified').checked = false;                document.getElementById('hrVerificationNotes').value = '';                                // Display employee information                const employeeInfo = document.getElementById('hrVerificationEmployeeInfo');                employeeInfo.innerHTML = `                    <h5>Mitarbeiterdaten</h5>                    <p><strong>Name:</strong> ${record.firstName} ${record.lastName}</p>                    <p><strong>Startdatum:</strong> ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</p>                    <p><strong>Büro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>                    <p><strong>Kontakt:</strong> ${record.phoneNumber || 'Keine Telefonnummer'}, ${record.mobileNumber || 'Keine Mobilnummer'}</p>                    <p><strong>E-Mail:</strong> ${record.emailAddress || 'Keine E-Mail-Adresse'}</p>                    <p><strong>Beschreibung:</strong> ${record.description || 'Keine Beschreibung'}</p>                `;                                // Display manager provided information                const managerInfo = document.getElementById('hrVerificationManagerInfo');                managerInfo.innerHTML = `                    <h5>Manager-Informationen</h5>                    <p><strong>Position:</strong> ${record.position || 'Nicht angegeben'}</p>                    <p><strong>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>                    <p><strong>Personalnummer:</strong> ${record.personalNumber || 'Nicht angegeben'}</p>                    <p><strong>Vertragslaufzeit:</strong> ${record.ablaufdatum ? new Date(record.ablaufdatum).toLocaleDateString('de-DE') : 'Unbefristet'}</p>                    <p><strong>Rolle:</strong> ${record.tl ? 'Teamleiter' : ''} ${record.al ? 'Abteilungsleiter' : ''}</p>                    <p><strong>Software:</strong> ${record.softwareSage ? 'Sage, ' : ''} ${record.softwareGenesis ? 'Genesis' : ''}</p>                    <p><strong>Zugänge:</strong> ${record.zugangLizenzmanager ? 'Lizenzmanager, ' : ''} ${record.zugangMS365 ? 'MS365' : ''}</p>                    <p><strong>Weitere Zugriffe:</strong> ${record.zugriffe || 'Keine'}</p>                    <p><strong>Ausstattung:</strong> ${record.equipment || 'Standard'}</p>                    <p><strong>Manager-Notizen:</strong> ${record.managerNotes || 'Keine Notizen'}</p>                `;                                // Show the modal                const modal = new bootstrap.Modal(document.getElementById('hrVerificationModal'));                modal.show();            } catch (error) {                console.error('Error loading record details for verification:', error);                alert('Fehler beim Laden der Prüfungsdaten: ' + error.message);            }        }                // IT checklist handling        async function openITChecklist(recordId) {            try {                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {                    method: 'GET',                    headers: {                        'Authorization': `Bearer ${authToken}`,                        'Content-Type': 'application/json'                    }                });                                if (!response.ok) {                    throw new Error('Failed to load record details');                }                                const record = await response.json();                                // Set modal title with employee name                document.getElementById('itModalTitle').textContent =                     `IT-Checkliste für ${record.firstName} ${record.lastName}`;                                // Set the record ID in hidden field                document.getElementById('itRecordId').value = record.recordId;                                // Reset form                document.getElementById('checkADAccount').checked = false;                document.getElementById('checkMailbox').checked = false;                document.getElementById('checkPermissions').checked = false;                document.getElementById('itNotes').value = record.itNotes || '';                                // Display employee information                const employeeInfo = document.getElementById('itEmployeeInfo');                employeeInfo.innerHTML = `                    <h5>Mitarbeiterdaten</h5>                    <div class="row">                        <div class="col-md-6">                            <p><strong>Name:</strong> ${record.firstName} ${record.lastName}</p>                            <p><strong>Position:</strong> ${record.position || 'Nicht angegeben'}</p>                            <p><strong>Abteilung:</strong> ${record.departmentField || 'Nicht angegeben'}</p>                            <p><strong>Startdatum:</strong> ${new Date(record.startWorkDate).toLocaleDateString('de-DE')}</p>                        </div>                        <div class="col-md-6">                            <p><strong>Büro:</strong> ${record.officeRoom || 'Nicht zugewiesen'}</p>                            <p><strong>E-Mail:</strong> ${record.emailAddress || 'Keine E-Mail-Adresse'}</p>                            <p><strong>Telefon:</strong> ${record.phoneNumber || 'Keine Telefonnummer'}</p>                            <p><strong>Personalnummer:</strong> ${record.personalNumber || 'Nicht angegeben'}</p>                        </div>                    </div>                `;                                // Build dynamic checklist based on manager selections                const dynamicChecklist = document.getElementById('itDynamicChecklist');                dynamicChecklist.innerHTML = '';                                // Software checks                if (record.softwareSage) {                    addChecklistItem(dynamicChecklist, 'checkSoftwareSage', 'Sage installieren');                }                                if (record.softwareGenesis) {                    addChecklistItem(dynamicChecklist, 'checkSoftwareGenesis', 'Genesis installieren');                }                                // Access checks                if (record.zugangLizenzmanager) {                    addChecklistItem(dynamicChecklist, 'checkLizenzmanager', 'Zugang zum Lizenzmanager einrichten');                }                                if (record.zugangMS365) {                    addChecklistItem(dynamicChecklist, 'checkMS365', 'MS365 Lizenz zuweisen');                }                                // Equipment check                if (record.equipment) {                    addChecklistItem(dynamicChecklist, 'checkEquipment', `${record.equipment} vorbereiten`);                }                                // Additional access checks                if (record.zugriffe) {                    addChecklistItem(dynamicChecklist, 'checkZugriffe', 'Zusätzliche Zugriffe einrichten');                }                                // Show the modal                const modal = new bootstrap.Modal(document.getElementById('itChecklistModal'));                modal.show();            } catch (error) {                console.error('Error loading record details for IT checklist:', error);                alert('Fehler beim Laden der Checkliste: ' + error.message);            }        }                function addChecklistItem(container, id, label) {            const item = document.createElement('div');            item.className = 'list-group-item';                        item.innerHTML = `                <div class="form-check">                    <input class="form-check-input" type="checkbox" id="${id}">                    <label class="form-check-label" for="${id}">${label}</label>                </div>            `;                        container.appendChild(item);        }                // Form submission handlers        async function submitManagerForm() {            const recordId = document.getElementById('managerRecordId').value;                        try {                const formData = {                    recordId: recordId,                    action: 'ManagerSubmit',                    position: document.getElementById('managerPosition').value,                    departmentField: document.getElementById('managerDepartment').value,                    personalNumber: document.getElementById('managerPersonalNumber').value,                    ablaufdatum: document.getElementById('managerTermination').value,                    tl: document.getElementById('managerTL').checked,                    al: document.getElementById('managerAL').checked,                    softwareSage: document.getElementById('managerSoftwareSage').checked,                    softwareGenesis: document.getElementById('managerSoftwareGenesis').checked,                    zugangLizenzmanager: document.getElementById('managerZugangLizenzmanager').checked,                    zugangMS365: document.getElementById('managerZugangMS365').checked,                    zugriffe: document.getElementById('managerZugriffe').value,                    equipment: document.getElementById('managerEquipment').value,                    managerNotes: document.getElementById('managerNotes').value                };                                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {                    method: 'PUT',                    headers: {                        'Authorization': `Bearer ${authToken}`,                        'Content-Type': 'application/json'                    },                    body: JSON.stringify(formData)                });                                if (!response.ok) {                    throw new Error('Failed to update record');                }                                // Close modal                bootstrap.Modal.getInstance(document.getElementById('managerFormModal')).hide();                                // Refresh records                loadManagerRecords();                                // Show success message                alert('Informationen erfolgreich übermittelt. HR wurde benachrichtigt.');            } catch (error) {                console.error('Error submitting manager form:', error);                alert('Fehler beim Speichern der Daten: ' + error.message);            }        }                async function submitHRVerification() {            const recordId = document.getElementById('hrVerificationRecordId').value;                        if (!document.getElementById('hrVerified').checked) {                alert('Bitte bestätigen Sie die Überprüfung aller Angaben.');                return;            }                        try {                const formData = {                    recordId: recordId,                    action: 'HRVerify',                    hrVerified: true,                    verificationNotes: document.getElementById('hrVerificationNotes').value,                    workflowState: 3 // ReadyForIT                };                                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {                    method: 'PUT',                    headers: {                        'Authorization': `Bearer ${authToken}`,                        'Content-Type': 'application/json'                    },                    body: JSON.stringify(formData)                });                                if (!response.ok) {                    throw new Error('Failed to update record');                }                                // Close modal                bootstrap.Modal.getInstance(document.getElementById('hrVerificationModal')).hide();                                // Refresh records                loadVerificationRecords();                                // Show success message                alert('Überprüfung abgeschlossen. Die IT-Abteilung wurde informiert.');            } catch (error) {                console.error('Error submitting HR verification:', error);                alert('Fehler bei der Bestätigung: ' + error.message);            }        }                async function submitITCompletion() {            const recordId = document.getElementById('itRecordId').value;                        // Check if all required checkboxes are checked            if (!document.getElementById('checkADAccount').checked || !document.getElementById('checkMailbox').checked) {                alert('Bitte stellen Sie sicher, dass AD-Account und Mailbox eingerichtet wurden.');                return;            }                        try {                const formData = {                    recordId: recordId,                    action: 'ITComplete',                    accountCreated: true,                    equipmentReady: true,                    itNotes: document.getElementById('itNotes').value,                    workflowState: 4 // Completed                };                                const response = await fetch(`${apiBaseUrl}/records/${recordId}`, {                    method: 'PUT',                    headers: {                        'Authorization': `Bearer ${authToken}`,                        'Content-Type': 'application/json'                    },                    body: JSON.stringify(formData)                });                                if (!response.ok) {                    throw new Error('Failed to update record');                }                                // Close modal                bootstrap.Modal.getInstance(document.getElementById('itChecklistModal')).hide();                                // Refresh records                loadITRecords();                                // Show success message                alert('Onboarding abgeschlossen!');            } catch (error) {                console.error('Error submitting IT completion:', error);                alert('Fehler beim Speichern: ' + error.message);            }        }                // CSV Export        async function exportCSV() {            try {                const response = await fetch(`${apiBaseUrl}/export`, {                    method: 'GET',                    headers: {                        'Authorization': `Bearer ${authToken}`,                        'Content-Type': 'application/json'                    }                });                                if (!response.ok) {                    throw new Error('Failed to export data');                }                                const blob = await response.blob();                const url = window.URL.createObjectURL(blob);                const a = document.createElement('a');                a.style.display = 'none';                a.href = url;                a.download = 'onboarding_export.csv';                document.body.appendChild(a);                a.click();                window.URL.revokeObjectURL(url);            } catch (error) {                console.error('Error exporting CSV:', error);                alert('Fehler beim Export: ' + error.message);            }
        }
        
        // Event handlers for tab switching
        document.addEventListener('DOMContentLoaded', function() {
            // ...existing code...
            
            // Tab change handlers with specific data loading
            const tabElements = document.querySelectorAll('button[data-bs-toggle="tab"]');
            tabElements.forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(event) {
                    const targetId = event.target.getAttribute('data-bs-target').substring(1);
                    
                    switch(targetId) {
                        case 'hr':
                            loadHRRecords();
                            break;
                        case 'manager':
                            loadManagerRecords();
                            break;
                        case 'verification':
                            loadVerificationRecords();
                            break;
                        case 'it':
                            loadITRecords();
                            break;
                    }
                });
            });
            
            // Manager form submission
            document.getElementById('btnManagerSubmit').addEventListener('click', submitManagerForm);
            
            // HR verification submission
            document.getElementById('btnHRVerify').addEventListener('click', submitHRVerification);
            
            // IT checklist submission
            document.getElementById('btnITComplete').addEventListener('click', submitITCompletion);
            
            // CSV export
            document.getElementById('btnExportCSV').addEventListener('click', exportCSV);
            
            // ...existing code...
        });
    </script>
</body>
                                    <li>Einrichten der Hardware</li>
                                    <li>Installation benötigter Software</li>
</html>
                                    <li>Konfigurieren der Zugriffsberechtigungen</li>
                                </ul>
                            </div>
                        `;
                        break;
                    case 4: // Completed
                        workflowSection.innerHTML = `
                            <div class="card-header bg-primary text-white">
                                <i class="bi bi-check-circle"></i> Onboarding abgeschlossen
                            </div>
                            <div class="card-body">
                                <p>Das Onboarding wurde erfolgreich abgeschlossen.</p>
                                <p><strong>Abgeschlossen am:</strong> ${new Date(record.lastUpdated).toLocaleDateString('de-DE')}</p>
                                <p><strong>Abgeschlossen von:</strong> ${record.lastUpdatedBy}</p>
                                <p><strong>IT-Notizen:</strong> ${record.itNotes || 'Keine'}</p>
                            </div>
                        `;
                        break;
                }
                modalBody.appendChild(workflowSection);
                
                // Add role-specific sections
                let actionSection;
                
                switch(userRole) {
                    case 'HR':
                        if (record.workflowState === 0) { // New
                            actionSection = createHREditSection(record);
                        } else if (record.workflowState === 2) { // Pending HR Verification
                            actionSection = createHRVerificationSection(record);
                        } else {
                            actionSection = createReadOnlySection('HR Hinweise', record.hrNotes);
                        }
                        break;
                        
                    case 'Manager':
                        if (record.workflowState === 1 && record.assignedManager === currentUser) { // Pending Manager Input
                            actionSection = createManagerEditSection(record);
                        } else {
                            actionSection = createReadOnlySection('Manager Hinweise', record.managerNotes);
                        }
                        break;
                        
                    case 'IT':
                        if (record.workflowState === 3) { // Ready for IT
                            actionSection = createITEditSection(record);
                        } else {
                            actionSection = createReadOnlySection('IT Hinweise', record.itNotes);
                        }
                        break;
                        
                    case 'Admin':
                        // Admins can edit most things
                        actionSection = createAdminEditSection(record);
                        break;
                }
                
                if (actionSection) {
                    modalBody.appendChild(actionSection);
                }
                
                // Add workflow history section
                const historySection = document.createElement('div');
                historySection.className = 'card mt-3';
                historySection.innerHTML = `
                    <div class="card-header bg-dark text-white">
                        <i class="bi bi-clock-history"></i> Workflow-Verlauf
                    </div>
                    <div class="card-body">
                        <p><strong>Status:</strong> <span class="state-badge ${getStateClass(record.workflowState)}">${getStateName(record.workflowState)}</span></p>
                        <p><strong>Erstellt am:</strong> ${new Date(record.createdDate).toLocaleString('de-DE')}</p>
                        <p><strong>Erstellt von:</strong> ${record.createdBy}</p>
                        <p><strong>Zuletzt aktualisiert:</strong> ${new Date(record.lastUpdated).toLocaleString('de-DE')}</p>
                        <p><strong>Aktualisiert von:</strong> ${record.lastUpdatedBy}</p>
                    </div>
                `;
                modalBody.appendChild(historySection);
                
                // Configure save button
                const saveButton = document.getElementById('saveRecordChanges');
                saveButton.dataset.recordId = record.recordId;
                
                // Set visibility of save button based on edit permissions
                if ((userRole === 'HR' && (record.workflowState === 0 || record.workflowState === 2)) ||
                    (userRole === 'Manager' && record.workflowState === 1 && record.assignedManager === currentUser) ||
                    (userRole === 'IT' && record.workflowState === 3) ||
                    userRole === 'Admin') {
                    saveButton.classList.remove('d-none');